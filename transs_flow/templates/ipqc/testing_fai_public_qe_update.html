<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QE Confirmation</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
         /* General Styles */
    .data-section {
        background: #f8fafc;
        border: 1px solid #e2e8f0;
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 24px;
    }
    .section-title {
        font-size: 1.25rem; /* 20px */
        font-weight: 700;
        color: #1f2937;
        margin-bottom: 16px;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    .section-title i {
        color: #3b82f6;
    }
    .field-grid {
        display: grid;
        gap: 16px;
        /* 2 columns on medium screens, 3 on large */
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    }
    .field-item {
        display: flex;
        flex-direction: column;
    }
    .field-label {
        font-size: 0.875rem; /* 14px */
        font-weight: 600;
        color: #374151;
        margin-bottom: 6px;
    }
    .field-value {
        font-size: 0.875rem; /* 14px */
        color: #111827;
        word-break: break-all;
    }

    /* Status Badge Styles */
    .status-badge {
        display: inline-flex;
        align-items: center;
        padding: 4px 10px;
        border-radius: 9999px; /* Fully rounded */
        font-size: 0.75rem; /* 12px */
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }
    .status-ok {
        background-color: #dcfce7;
        color: #166534;
    }
    .status-not-ok {
        background-color: #fecaca;
        color: #991b1b;
    }
    .status-na {
        background-color: #f3f4f6;
        color: #6b7280;
    }

    /* Evidence Gallery Styles */
    .evidence-gallery {
        margin-top: 32px;
    }
    .evidence-gallery-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        gap: 16px;
    }
    .evidence-item {
        border: 1px solid #e5e7eb;
        border-radius: 12px;
        overflow: hidden;
        background: white;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        cursor: pointer;
    }
    .evidence-item:hover {
        transform: scale(1.05);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
    }
    .evidence-item img {
        width: 100%;
        height: 150px;
        object-fit: cover;
        display: block;
    }
    .evidence-item figcaption {
        background: #f9fafb;
        padding: 8px 12px;
        font-size: 0.875rem; /* 14px */
        color: #374151;
        text-align: center;
        border-top: 1px solid #e5e7eb;
    }

    /* Photo Overlay Styles */
    .photo-preview-overlay {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.85);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 9999;
        padding: 20px;
        backdrop-filter: blur(4px);
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.3s ease, visibility 0.3s ease;
    }
    .photo-preview-overlay.active {
        opacity: 1;
        visibility: visible;
    }
    .photo-preview-container {
        background: white;
        border-radius: 12px;
        max-width: 90vw;
        max-height: 90vh;
        overflow: hidden;
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        display: flex;
        flex-direction: column;
    }
    .photo-preview-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 16px 20px;
        background: #f9fafb;
        border-bottom: 1px solid #e5e7eb;
    }
    .photo-preview-header h2 {
        font-size: 1.125rem; /* 18px */
        font-weight: 600;
        color: #111827;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        max-width: 80%;
    }
    .photo-preview-body {
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 16px;
        background: #111827;
        flex-grow: 1;
    }
    .photo-preview-body img {
        max-width: 100%;
        max-height: 100%;
        object-fit: contain;
        border-radius: 8px;
    }
    .preview-btn {
        background: #3b82f6;
        color: white;
        padding: 8px 12px;
        border-radius: 8px;
        font-size: 0.875rem;
        font-weight: 500;
        cursor: pointer;
        transition: background-color 0.2s;
    }
    .preview-btn:hover {
        background: #1d4ed8;
    }
    </style>
</head>
<body>
<div class="min-h-screen bg-gray-100">
    <!-- Header -->
    <div class="bg-gradient-to-r from-blue-500 to-blue-600 text-white p-6 shadow-lg">
        <div class="container mx-auto flex flex-col items-center justify-center text-center py-6">
        <h1 class="text-2xl font-bold">FAI Record Review & Confirmation</h1>
        <p class="text-blue-100">First Article Inspection - Quality Engineering Approval</p>
    </div>
    </div>

    <!-- Main Content -->
    <div class="container mx-auto p-4 md:p-8">

        <!-- Record Summary Bar -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-8 flex flex-wrap justify-around items-center text-center gap-4">
            <div>
                <p class="text-sm text-gray-500 uppercase tracking-wide">IPQC</p>
                <p class="text-xl font-bold text-gray-900">{{ fai_record.name }}</p>
            </div>
            <div>
                <p class="text-sm text-gray-500 uppercase tracking-wide">Model</p>
                <p class="text-xl font-bold text-gray-900">{{ fai_record.model }}</p>
            </div>
            <div>
                <p class="text-sm text-gray-500 uppercase tracking-wide">Color</p>
                <p class="text-xl font-bold text-gray-900">{{ fai_record.color }}</p>
            </div>
            <div>
                <p class="text-sm text-gray-500 uppercase tracking-wide">Line</p>
                <p class="text-xl font-bold text-gray-900">{{ fai_record.line }}</p>
            </div>
            <div>
                <p class="text-sm text-gray-500 uppercase tracking-wide">Inspection Date</p>
                <p class="text-xl font-bold text-gray-900">{{ fai_record.date|date:"Y-m-d" }}</p>
            </div>
            <div>
                <p class="text-sm text-gray-500 uppercase tracking-wide">Status</p>
                <p class="text-xl font-bold {% if fai_record.qe_confirm_status == 'Approved' %}text-green-600{% elif fai_record.qe_confirm_status == 'Not Approved' %}text-red-600{% else %}text-gray-600{% endif %}">
                    {% if fai_record.qe_confirm_status %}{{ fai_record.qe_confirm_status }}{% else %}Pending{% endif %}
                </p>
            </div>
        </div>

        <!-- INSPECTION DATA -->
        <div class="space-y-8">
            <!-- Order & Software Section -->
            <div class="data-section">
                <h3 class="section-title">
                    <i class="fas fa-cogs text-green-600"></i>
                    Order & Software Checks
                </h3>
                <div class="field-grid">
                    <div class="field-item">
                        <span class="field-label">First Article Type</span>
                        <span class="field-value">{{ fai_record.get_first_article_type_display }}</span>
                    </div>
                    <div class="field-item">
                        <span class="field-label">Software Version Check</span>
                        <div class="field-value">
                            <span class="status-badge {% if fai_record.software_ver_check == 'OK' %}status-ok{% elif fai_record.software_ver_check == 'Not OK' %}status-not-ok{% else %}status-na{% endif %}">
                                {{ fai_record.software_ver_check|default:"N/A" }}
                            </span>
                        </div>
                    </div>
                    <div class="field-item">
                        <span class="field-label">OS Version Check</span>
                        <div class="field-value">
                            <span class="status-badge {% if fai_record.android_ver_check == 'OK' %}status-ok{% elif fai_record.android_ver_check == 'Not OK' %}status-not-ok{% else %}status-na{% endif %}">
                                {{ fai_record.android_ver_check|default:"N/A" }}
                            </span>
                        </div>
                    </div>
                    <div class="field-item">
                        <span class="field-label">Memory Check</span>
                        <div class="field-value">
                            <span class="status-badge {% if fai_record.memory_inbuilt_check == 'OK' %}status-ok{% elif fai_record.memory_inbuilt_check == 'Not OK' %}status-not-ok{% else %}status-na{% endif %}">
                                {{ fai_record.memory_inbuilt_check|default:"N/A" }}
                            </span>
                        </div>
                    </div>
                    <div class="field-item">
                        <span class="field-label">Order Confirmation</span>
                        <div class="field-value">
                            <span class="status-badge {% if fai_record.order_confirm_check == 'OK' %}status-ok{% elif fai_record.order_confirm_check == 'Not OK' %}status-not-ok{% else %}status-na{% endif %}">
                                {{ fai_record.order_confirm_check|default:"N/A" }}
                            </span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Visual & Labels Section -->
            <div class="data-section">
                <h3 class="section-title">
                    <i class="fas fa-eye text-purple-600"></i>
                    Visual & Label Checks
                </h3>
                <div class="field-grid">
                    <div class="field-item"><span class="field-label">Visual Inspection</span><div class="field-value">{{ fai_record.visual_inspection_handset|default:"N/A" }}</div></div>
                    <div class="field-item"><span class="field-label">Label Check</span>
                        <div class="field-value">
                            <span class="status-badge {% if fai_record.label_check == 'OK' %}status-ok{% elif fai_record.label_check == 'Not OK' %}status-not-ok{% else %}status-na{% endif %}">
                                {{ fai_record.label_check|default:"N/A" }}
                            </span>
                        </div>
                    </div>
                    <div class="field-item"><span class="field-label">Label Position</span>
                        <div class="field-value">
                            <span class="status-badge {% if fai_record.label_position_check == 'OK' %}status-ok{% elif fai_record.label_position_check == 'Not OK' %}status-not-ok{% else %}status-na{% endif %}">
                                {{ fai_record.label_position_check|default:"N/A" }}
                            </span>
                        </div>
                    </div>
                    <div class="field-item"><span class="field-label">Logo Check</span>
                        <div class="field-value">
                            <span class="status-badge {% if fai_record.logo_check == 'OK' %}status-ok{% elif fai_record.logo_check == 'Not OK' %}status-not-ok{% else %}status-na{% endif %}">
                                {{ fai_record.logo_check|default:"N/A" }}
                            </span>
                        </div>
                    </div>
                    <div class="field-item"><span class="field-label">Assembly Check</span>
                        <div class="field-value">
                            <span class="status-badge {% if fai_record.assembly_battery_check == 'OK' %}status-ok{% elif fai_record.assembly_battery_check == 'Not OK' %}status-not-ok{% else %}status-na{% endif %}">
                                {{ fai_record.assembly_battery_check|default:"N/A" }}
                            </span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Functional Tests Section (Sample - you can expand this with all fields) -->
             <div class="data-section">
                <h3 class="section-title">
                    <i class="fas fa-mobile-alt text-blue-600"></i>
                    Functional Tests
                </h3>
                <div class="field-grid">
                  <div class="field-item"><span class="field-label">TP with Charge Test</span><div class="field-value">{{ fai_record.tp_with_charge_test|default:"N/A" }}</div></div>
                  <div class="field-item"><span class="field-label">15min Charging Test</span><div class="field-value">{{ fai_record.charge_15min_test|default:"N/A" }}</div></div>
                  <div class="field-item"><span class="field-label">Boot Time Test</span><div class="field-value">{{ fai_record.boot_time_test|default:"N/A" }}</div></div>
                  <div class="field-item"><span class="field-label">Init Settings Test</span><div class="field-value">{{ fai_record.init_settings_test|default:"N/A" }}</div></div>
                  <div class="field-item"><span class="field-label">Buttons/Keys Test</span><div class="field-value">{{ fai_record.buttons_keys_test|default:"N/A" }}</div></div>
                  <div class="field-item"><span class="field-label">Touch Screen Pen Test</span><div class="field-value">{{ fai_record.touch_screen_pen_test|default:"N/A" }}</div></div>
                  <div class="field-item"><span class="field-label">Calling Test</span><div class="field-value">{{ fai_record.calling_test|default:"N/A" }}</div></div>
                  <div class="field-item"><span class="field-label">Bluetooth Test</span><div class="field-value">{{ fai_record.bluetooth_test|default:"N/A" }}</div></div>
                  <div class="field-item"><span class="field-label">Flashlight Test</span><div class="field-value">{{ fai_record.flashlight_test|default:"N/A" }}</div></div>
                  <div class="field-item"><span class="field-label">Camera Flash Test</span><div class="field-value">{{ fai_record.camera_flash_test|default:"N/A" }}</div></div>
                  <div class="field-item"><span class="field-label">Camera Photo Test</span><div class="field-value">{{ fai_record.camera_photo_test|default:"N/A" }}</div></div>
                  <div class="field-item"><span class="field-label">Long Distance Check</span><div class="field-value">{{ fai_record.camera_long_distance_check|default:"N/A" }}</div></div>
                  <div class="field-item"><span class="field-label">High-Light Defect Check</span><div class="field-value">{{ fai_record.highlight_defect_check|default:"N/A" }}</div></div>
                  <div class="field-item"><span class="field-label">Multimedia Play Test</span><div class="field-value">{{ fai_record.multimedia_play_test|default:"N/A" }}</div></div>
                  <div class="field-item"><span class="field-label">FM Play Test</span><div class="field-value">{{ fai_record.fm_play_test|default:"N/A" }}</div></div>
                  <div class="field-item"><span class="field-label">TV Function Test</span><div class="field-value">{{ fai_record.tv_fn_test|default:"N/A" }}</div></div>
                  <div class="field-item"><span class="field-label">Taping Function Test</span><div class="field-value">{{ fai_record.taping_fn_test|default:"N/A" }}</div></div>
                  <div class="field-item"><span class="field-label">Shaking Screen Test</span><div class="field-value">{{ fai_record.shaking_screen_test|default:"N/A" }}</div></div>
                  <div class="field-item"><span class="field-label">WiFi Test</span><div class="field-value">{{ fai_record.wifi_test|default:"N/A" }}</div></div>
                  <div class="field-item"><span class="field-label">Gravity Sensor Test</span><div class="field-value">{{ fai_record.gravity_sensor_test|default:"N/A" }}</div></div>
                  <div class="field-item"><span class="field-label">Light/Distance Sensor Test</span><div class="field-value">{{ fai_record.light_distance_sensor_test|default:"N/A" }}</div></div>
                  <div class="field-item"><span class="field-label">Hall Function Test</span><div class="field-value">{{ fai_record.hall_fn_test|default:"N/A" }}</div></div>
                  <div class="field-item"><span class="field-label">QR Scan Test</span><div class="field-value">{{ fai_record.qr_scan_test|default:"N/A" }}</div></div>
                  <div class="field-item"><span class="field-label">RAM/ROM Capacity Test</span><div class="field-value">{{ fai_record.ram_rom_cap_test|default:"N/A" }}</div></div>
                  <div class="field-item"><span class="field-label">Mode Switch Test</span><div class="field-value">{{ fai_record.mode_switch_test|default:"N/A" }}</div></div>
                  <div class="field-item"><span class="field-label">Touch in Dev Options Test</span><div class="field-value">{{ fai_record.touch_in_dev_opt_test|default:"N/A" }}</div></div>
                  <div class="field-item"><span class="field-label">MAC Address Test</span><div class="field-value">{{ fai_record.mac_add_test|default:"N/A" }}</div></div>
                  <div class="field-item"><span class="field-label">OTG Function Test</span><div class="field-value">{{ fai_record.otg_fn_test|default:"N/A" }}</div></div>
              </div>
            </div>

            <!-- Final Results Section -->
            <div class="data-section">
                <h3 class="section-title">
                    <i class="fas fa-clipboard-check text-red-600"></i>
                    Final Results & Details
                </h3>
                <div class="field-grid">
                    <div class="field-item"><span class="field-label">Sample S/N</span><div class="field-value font-mono">{{ fai_record.sample_serial_number }}</div></div>
                    <div class="field-item"><span class="field-label">IMEI Number</span><div class="field-value font-mono">{{ fai_record.imei_number }}</div></div>
                    <div class="field-item"><span class="field-label">Visual Result</span>
                         <div class="field-value">
                            <span class="status-badge {% if fai_record.visual_functional_result == 'QUALIFIED' %}status-ok{% elif fai_record.visual_functional_result == 'UNQUALIFIED' %}status-not-ok{% else %}status-na{% endif %}">
                                {{ fai_record.visual_functional_result }}
                            </span>
                        </div>
                    </div>
                    <div class="field-item"><span class="field-label">Reliability Result</span>
                        <div class="field-value">
                            <span class="status-badge {% if fai_record.reliability_result == 'QUALIFIED' %}status-ok{% elif fai_record.reliability_result == 'UNQUALIFIED' %}status-not-ok{% else %}status-na{% endif %}">
                                {{ fai_record.reliability_result }}
                            </span>
                        </div>
                </div>
            </div>

            <!-- EVIDENCE PHOTOS GALLERY -->
            <div class="evidence-gallery">
                <h3 class="section-title">
                    <i class="fas fa-images text-indigo-600"></i>
                    Evidence Photos
                </h3>
                <div class="evidence-gallery-grid">
                    {% if fai_record.label_check_evidence %}
                    <div class="evidence-item" onclick="openPhotoPreview('{{ fai_record.label_check_evidence.url }}', 'Label Check Evidence')">
                        <img src="{{ fai_record.label_check_evidence.url }}" alt="Label Check">
                        <figcaption>Label Check</figcaption>
                    </div>
                    {% endif %}
                    {% if fai_record.label_position_check_evidence %}
                    <div class="evidence-item" onclick="openPhotoPreview('{{ fai_record.label_position_check_evidence.url }}', 'Label Position Evidence')">
                        <img src="{{ fai_record.label_position_check_evidence.url }}" alt="Label Position">
                        <figcaption>Label Position</figcaption>
                    </div>
                    {% endif %}
                    {% if fai_record.logo_check_evidence %}
                    <div class="evidence-item" onclick="openPhotoPreview('{{ fai_record.logo_check_evidence.url }}', 'Logo Evidence')">
                        <img src="{{ fai_record.logo_check_evidence.url }}" alt="Logo">
                        <figcaption>Logo</figcaption>
                    </div>
                    {% endif %}
                    {% if fai_record.assembly_battery_check_evidence %}
                    <div class="evidence-item" onclick="openPhotoPreview('{{ fai_record.assembly_battery_check_evidence.url }}', 'Assembly Evidence')">
                        <img src="{{ fai_record.assembly_battery_check_evidence.url }}" alt="Assembly">
                        <figcaption>Assembly</figcaption>
                    </div>
                    {% endif %}
                     {% if fai_record.boot_time_test_evidence %}
                    <div class="evidence-item" onclick="openPhotoPreview('{{ fai_record.boot_time_test_evidence.url }}', 'Boot Time Video')">
                        <img src="{{ fai_record.boot_time_test_evidence.url }}" alt="Boot Time">
                        <figcaption>Boot Time Video</figcaption>
                    </div>
                    {% endif %}
                    {% if fai_record.camera_front_test_evidence %}
                    <div class="evidence-item" onclick="openPhotoPreview('{{ fai_record.camera_front_test_evidence.url }}', 'Front Camera Photo')">
                        <img src="{{ fai_record.camera_front_test_evidence.url }}" alt="Front Camera">
                        <figcaption>Front Camera</figcaption>
                    </div>
                    {% endif %}
                    {% if fai_record.camera_back_test_evidence %}
                    <div class="evidence-item" onclick="openPhotoPreview('{{ fai_record.camera_back_test_evidence.url }}', 'Back Camera Photo')">
                        <img src="{{ fai_record.camera_back_test_evidence.url }}" alt="Back Camera">
                        <figcaption>Back Camera</figcaption>
                    </div>
                    {% endif %}
                    {% if fai_record.camera_dark_test_evidence %}
                    <div class="evidence-item" onclick="openPhotoPreview('{{ fai_record.camera_dark_test_evidence.url }}', 'Low Light Camera')">
                        <img src="{{ fai_record.camera_dark_test_evidence.url }}" alt="Low Light Camera">
                        <figcaption>Dark/Low Light</figcaption>
                    </div>
                    {% endif %}
                    {% if fai_record.high_temp_camera_test_evidence %}
                    <div class="evidence-item" onclick="openPhotoPreview('{{ fai_record.high_temp_camera_test_evidence.url }}', 'High Temp Camera')">
                        <img src="{{ fai_record.high_temp_camera_test_evidence.url }}" alt="High Temp Camera">
                        <figcaption>High Temp Test</figcaption>
                    </div>
                    {% endif %}
                    {% if fai_record.imei_photo %}
                    <div class="evidence-item" onclick="openPhotoPreview('{{ fai_record.imei_photo.url }}', 'IMEI Verification Photo')">
                        <img src="{{ fai_record.imei_photo.url }}" alt="IMEI Photo">
                        <figcaption>IMEI Photo</figcaption>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- QE CONFERENCE FORM -->
        <div class="mt-12 bg-white rounded-lg shadow-md p-8">
             <h3 class="text-xl font-bold text-gray-800 mb-6 border-b pb-3">Quality Engineering Confirmation</h3>
            <form method="post" id="qeForm" class="space-y-6">
                {% csrf_token %}
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="qe_confirm_name" class="block text-sm font-medium text-gray-700">QE Name</label>
                        <input type="text" id="qe_confirm_name" name="qe_confirm_name" value="{{ fai_record.qe_confirm_name }}" 
                               {% if fai_record.qe_confirm_name %}readonly{% endif %}
                               class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 {% if fai_record.qe_confirm_name %}bg-gray-100{% endif %}" 
                               required>
                    </div>
                    <div>
                        <label for="qe_confirm_status" class="block text-sm font-medium text-gray-700">Approval Status</label>
                        <select id="qe_confirm_status" name="qe_confirm_status" 
                                {% if fai_record.qe_confirm_status %}disabled{% endif %}
                                class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 {% if fai_record.qe_confirm_status %}bg-gray-100{% endif %}" 
                                required>
                            <option value="">-- Select Status --</option>
                            <option value="Approved" {% if fai_record.qe_confirm_status == 'Approved' %}selected{% endif %}>Approved</option>
                            <option value="Not Approved" {% if fai_record.qe_confirm_status == 'Not Approved' %}selected{% endif %}>Not Approved</option>
                            <option value="NA" {% if fai_record.qe_confirm_status == 'NA' %}selected{% endif %}>NA</option>
                        </select>
                    </div>
                </div>
                 <div class="mt-8">
                    {% if fai_record.qe_confirm_name %}
                    <button type="button" disabled class="w-full bg-gray-400 border border-transparent rounded-md shadow-sm py-3 px-4 text-sm font-medium text-gray-500 cursor-not-allowed flex items-center justify-center">
                        <i class="fas fa-lock mr-2"></i> Already Submitted
                    </button>
                    {% else %}
                    <button type="submit" class="w-full bg-blue-600 border border-transparent rounded-md shadow-sm py-3 px-4 text-sm font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 flex items-center justify-center">
                         <i class="fas fa-check mr-2"></i> Submit Confirmation
                    </button>
                    {% endif %}
                </div>
            </form>
        </div>

    </div>
</div>

<!-- Photo Preview Overlay -->
<div id="photoPreviewOverlay" class="photo-preview-overlay">
    <div class="photo-preview-container">
        <div class="photo-preview-header">
            <h2 id="photoPreviewLabel">Photo Preview</h2>
            <div class="flex gap-3">
                <a id="photoDownloadBtn" href="#" target="_blank" download class="preview-btn">
                    <i class="fas fa-download"></i> Download
                </a>
                <button id="photoCloseBtn" class="preview-btn">
                    <i class="fas fa-times"></i> Close
                </button>
            </div>
        </div>
        <div class="photo-preview-body">
            <img id="photoPreviewImg" src="" alt="">
        </div>
    </div>
</div>

<!-- Toast Notification -->
<div id="toast" class="fixed bottom-4 right-4 z-50 transform transition-all duration-300 translate-y-full opacity-0 pointer-events-none">
    <div class="bg-gray-800 text-white px-6 py-4 rounded-lg shadow-2xl flex items-center space-x-3">
        <i id="toastIcon" class="fas fa-check-circle text-green-400"></i>
        <span id="toastMessage"></span>
    </div>
</div>

<!-- Django Messages -->
{% if messages %}
    {% for message in messages %}
        <div class="fixed top-4 right-4 z-50 p-4 max-w-sm w-full bg-green-50 border border-green-200 text-green-800 rounded-lg shadow-lg transition-all duration-300">
            {{ message }}
        </div>
    {% endfor %}
{% endif %}

<script>
// Photo Viewer Functions
function openPhotoPreview(url, label) {
    const overlay = document.getElementById('photoPreviewOverlay');
    const img = document.getElementById('photoPreviewImg');
    const labelEl = document.getElementById('photoPreviewLabel');
    const downloadBtn = document.getElementById('photoDownloadBtn');

    img.src = url;
    img.alt = label;
    labelEl.textContent = label;
    downloadBtn.href = url;
    
    overlay.classList.add('active');
    document.body.style.overflow = 'hidden'; // Prevent background scroll
}

function closePhotoPreview() {
    const overlay = document.getElementById('photoPreviewOverlay');
    overlay.classList.remove('active');
    document.body.style.overflow = 'auto'; // Restore background scroll
}

// Attach event listeners
document.addEventListener('DOMContentLoaded', function() {
    const closeBtn = document.getElementById('photoCloseBtn');
    const overlay = document.getElementById('photoPreviewOverlay');

    if (closeBtn && overlay) {
        closeBtn.addEventListener('click', closePhotoPreview);
        // Close on overlay click
        overlay.addEventListener('click', function(e) {
            if (e.target === overlay) {
                closePhotoPreview();
            }
        });
        // Close on Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closePhotoPreview();
            }
        });
    }

    // Form submission handling
    const qeForm = document.getElementById('qeForm');
    if (qeForm) {
        qeForm.addEventListener('submit', function() {
            const submitBtn = qeForm.querySelector('button[type="submit"]');
            if (submitBtn) {
                submitBtn.disabled = true;
                submitBtn.innerHTML = '<i class="fas fa-spinner fa-pulse mr-2"></i> Submitting...';
            }
        });
    }
});

// Toast Notification Function
function showToast(message, type = 'success') {
    const toast = document.getElementById('toast');
    const toastMessage = document.getElementById('toastMessage');
    const toastIcon = document.getElementById('toastIcon');

    toastMessage.textContent = message;
    
    // Reset classes
    toast.className = 'fixed bottom-4 right-4 z-50 transform transition-all duration-300 flex items-center space-x-3 px-6 py-4 rounded-lg shadow-2xl max-w-sm w-full';
    
    if (type === 'success') {
        toast.classList.add('bg-green-50', 'border-green-200', 'text-green-800');
        toastIcon.className = 'fas fa-check-circle text-green-400';
    } else if (type === 'error') {
        toast.classList.add('bg-red-50', 'border-red-200', 'text-red-800');
        toastIcon.className = 'fas fa-exclamation-circle text-red-400';
    }
    
    // Animate in
    setTimeout(() => {
        toast.classList.remove('translate-y-full', 'opacity-0', 'pointer-events-none');
        toast.classList.add('translate-y-0', 'opacity-1', 'pointer-events-auto');
    }, 100);

    // Animate out
    setTimeout(() => {
        toast.classList.add('translate-y-full', 'opacity-0', 'pointer-events-none');
        setTimeout(() => {
            toast.remove();
        }, 300);
    }, 3000);
}

// Auto-hide Django messages
document.addEventListener('DOMContentLoaded', function(){
    setTimeout(() => {
        const messages = document.querySelectorAll('[class*="bg-green-50"]');
        messages.forEach(msg => {
            msg.style.opacity = '0';
            msg.style.transform = 'translateY(20px)';
            setTimeout(() => msg.remove(), 500);
        });
    }, 5000);
});
</script>
</body>
</html>