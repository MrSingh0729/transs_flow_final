<!-- templates/ipqc/create_dynamic_form.html -->
{% extends 'base.html' %}
{% block title %}Create Dynamic Form{% endblock %}
{% block content %}
<div class="space-y-6">
    <!-- Header -->
    <div class="mb-8 text-center">
        <h1 class="text-3xl font-bold glow-text">
            <i class="fas fa-wpforms mr-3 text-purple-400"></i>
            Create Dynamic Form
        </h1>
        <p class="text-gray-400 mt-2">Create custom forms for flexible data collection</p>
    </div>
    <!-- Form Creator -->
    <div class="holographic-card rounded-xl p-6">
        <form method="post" id="dynamicForm" class="space-y-6">
            {% csrf_token %}
            <!-- Basic Information -->
            <div class="holographic-card rounded-lg p-6">
                <h2 class="text-lg font-bold mb-4 text-white">
                    <i class="fas fa-info-circle mr-2 text-cyan-400"></i>
                    Form Information
                </h2>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Form Title *</label>
                        <input type="text" name="title" required
                               class="w-full px-4 py-3 bg-gray-700 border border-cyan-500 rounded-lg focus:ring-2 focus:ring-cyan-500 text-white"
                               placeholder="Enter form title">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Description</label>
                        <textarea name="description" rows="3"
                                  class="w-full px-4 py-3 bg-gray-700 border border-cyan-500 rounded-lg focus:ring-2 focus:ring-cyan-500 text-gray-400"
                                  placeholder="Describe the form purpose"></textarea>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Lark Bitable Table ID</label>
                        <input type="text" name="lark_bitable_table_id" required
                               class="w-full px-4 py-3 bg-gray-700 border border-cyan-500 rounded-lg focus:ring-2 focus:ring-cyan-500 text-white"
                               placeholder="Enter Lark Bitable table ID">
                    </div>
                </div>
            </div>
            <!-- Dynamic Fields Section -->
            <div class="holographic-card rounded-lg p-6">
                <h2 class="text-lg font-bold mb-4 text-white">
                    <i class="fas fa-layer-group mr-2 text-green-400"></i>
                    Form Fields
                </h2>
                <div id="fieldsContainer" class="space-y-4">
                    <!-- Initial Field -->
                    <div class="flex items-center space-x-4 p-4 bg-gray-800 rounded-lg">
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Field Label</label>
                            <input type="text" id="fieldLabel" placeholder="e.g., Employee Name"
                                   class="flex-1 px-4 py-3 bg-gray-700 border border-cyan-500 rounded-lg focus:ring-2 focus:ring-cyan-500 text-white">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Field Type</label>
                            <select id="fieldType" onchange="updateFieldOptions()"
                                    class="px-4 py-3 bg-gray-700 border border-cyan-500 rounded-lg focus:ring-2 focus:ring-cyan-500 text-white">
                                <option value="">Select Type</option>
                                <option value="text">Text</option>
                                <option value="number">Number</option>
                                <option value="date">Date</option>
                                <option value="select">Dropdown</option>
                                <option value="checkbox">Checkbox</option>
                                <option value="textarea">Textarea</option>
                            </select>
                        </div>
                        <button type="button" onclick="addField()" 
                                class="cyber-button px-4 py-2 text-white rounded-lg hover:scale-105 transition-all duration-200">
                            <i class="fas fa-plus mr-2"></i>
                            Add Field
                        </button>
                    </div>
                </div>
                <!-- Field Options (shown when type is select) -->
                <div id="fieldOptions" class="hidden mt-4">
                    <label class="block text-sm font-medium text-gray-300 mb-2">Options (comma-separated)</label>
                    <textarea id="fieldOptionsText" rows="3"
                              class="w-full px-4 py-3 bg-gray-700 border border-cyan-500 rounded-lg focus:ring-2 focus:ring-cyan-500 text-gray-400"
                              placeholder="Option1,Option2,Option3"></textarea>
                </div>
            </div>
            <!-- Hidden Fields Storage -->
            <input type="hidden" id="fieldsData" name="fields_data">
            <!-- Submit Button -->
            <div class="flex justify-center pt-8">
                <button type="submit" 
                        class="cyber-button px-8 py-4 text-white font-semibold rounded-lg hover:scale-105 transform transition-all duration-200">
                    <i class="fas fa-save mr-2"></i>
                    Create Dynamic Form
                </button>
            </div>
        </form>
    </div>
</div>
<script>
    let fieldCount = 0;
    let fields = [];
    function addField() {
        const label = document.getElementById('fieldLabel').value;
        const type = document.getElementById('fieldType').value;
        const optionsDiv = document.getElementById('fieldOptions');
        if (!label || !type) {
            alert('Please enter field label and select type');
            return;
        }
        const field = {
            label: label,
            type: type,
            options: type === 'select' ? document.getElementById('fieldOptionsText').value.split(',').map(opt => opt.trim()) : []
        };
        fields.push(field);
        fieldCount++;
        // Add visual field representation
        addFieldVisual(field);
        // Reset form
        document.getElementById('fieldLabel').value = '';
        document.getElementById('fieldType').value = '';
        document.getElementById('fieldOptionsText').value = '';
        updateFieldOptions();
        // Update hidden field data
        document.getElementById('fieldsData').value = JSON.stringify(fields);
    }
    function removeField(index) {
        fields.splice(index, 1);
        fieldCount--;
        refreshFields();
    }
    function updateFieldOptions() {
        const type = document.getElementById('fieldType').value;
        const optionsDiv = document.getElementById('fieldOptions');
        if (type === 'select') {
            optionsDiv.classList.remove('hidden');
        } else {
            optionsDiv.classList.add('hidden');
        }
    }
    function addFieldVisual(field) {
        const container = document.getElementById('fieldsContainer');
        const fieldDiv = document.createElement('div');
        fieldDiv.className = 'flex items-center justify-between p-4 bg-gray-800 rounded-lg hover:bg-gray-700 transition-colors';
        const labelSpan = document.createElement('span');
        labelSpan.className = 'text-sm font-medium text-cyan-400';
        labelSpan.textContent = field.label;
        const typeSpan = document.createElement('span');
        typeSpan.className = 'px-2 py-1 bg-purple-500 bg-opacity-20 text-purple-400 rounded-full text-xs';
        typeSpan.textContent = field.type.toUpperCase();
        const optionsSpan = document.createElement('span');
        optionsSpan.className = 'text-xs text-gray-400';
        optionsSpan.textContent = field.options.length > 0 ? `(${field.options.length} options)` : '';
        const removeBtn = document.createElement('button');
        removeBtn.className = 'text-red-400 hover:text-red-300 ml-2';
        removeBtn.innerHTML = '<i class="fas fa-trash"></i>';
        removeBtn.onclick = () => {
            const index = Array.from(container.children).indexOf(fieldDiv);
            removeField(index);
        };
        const moveUpBtn = document.createElement('button');
        moveUpBtn.className = 'text-gray-400 hover:text-gray-300';
        moveUpBtn.innerHTML = '<i class="fas fa-arrow-up"></i>';
        moveUpBtn.onclick = () => {
            const index = Array.from(container.children).indexOf(fieldDiv);
            if (index > 0) {
                const temp = fields[index];
                fields[index] = fields[index - 1];
                fields[index - 1] = temp;
                refreshFields();
            }
        };
        const moveDownBtn = document.createElement('button');
        moveDownBtn.className = 'text-gray-400 hover:text-gray-300';
        moveDownBtn.innerHTML = '<i class="fas fa-arrow-down"></i>';
        moveDownBtn.onclick = () => {
            const index = Array.from(container.children).indexOf(fieldDiv);
            if (index < fields.length - 1) {
                const temp = fields[index];
                fields[index] = fields[index + 1];
                fields[index + 1] = temp;
                refreshFields();
            }
        };
        labelSpan.appendChild(typeSpan);
        labelSpan.appendChild(optionsSpan);
        labelSpan.appendChild(removeBtn);
        labelSpan.appendChild(moveUpBtn);
        labelSpan.appendChild(moveDownBtn);
        fieldDiv.appendChild(labelSpan);
        fieldDiv.appendChild(typeSpan);
        container.insertBefore(fieldDiv, container.firstChild);
    }
    function refreshFields() {
        const container = document.getElementById('fieldsContainer');
        container.innerHTML = '';
        fields.forEach((field, index) => {
            const fieldDiv = document.createElement('div');
            fieldDiv.className = 'flex items-center justify-between p-4 bg-gray-800 rounded-lg';
            fieldDiv.innerHTML = `
                <div class="flex items-center">
                    <span class="text-sm font-medium text-cyan-400">${index + 1}. ${field.label}</span>
                    <span class="px-2 py-1 bg-purple-500 bg-opacity-20 text-purple-400 rounded-full text-xs">${field.type.toUpperCase()}</span>
                    <span class="text-xs text-gray-400">${field.options.length > 0 ? `(${field.options.length} options)` : ''}</span>
                </div>
                <div class="flex items-center space-x-2">
                    <button type="button" onclick="addField()" class="text-green-400 hover:text-green-300">
                        <i class="fas fa-plus"></i>
                    </button>
                    <button type="button" onclick="removeField(${index})" class="text-red-400 hover:text-red-300">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `;
            container.appendChild(fieldDiv);
        });
    }
</script>
{% endblock %}