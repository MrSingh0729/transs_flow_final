accounts/models.py:


from django.contrib import admin
from django.contrib.auth.admin import UserAdmin
from .models import Employee

class EmployeeAdmin(UserAdmin):
    model = Employee
    # Replace 'username' with your USERNAME_FIELD
    list_display = ("employee_id", "full_name", "role", "department", "factory_code", "is_staff", "is_superuser")
    
    # Set fieldsets for admin create/edit page
    fieldsets = (
        (None, {"fields": ("employee_id", "password")}),
        ("Personal Info", {"fields": ("full_name", "role", "department", "factory_code", "factory_name", "country_code", "country_name")}),
        ("Permissions", {"fields": ("is_active", "is_staff", "is_superuser", "groups", "user_permissions")}),
        ("Important dates", {"fields": ("last_login",)}),
    )

    add_fieldsets = (
        (None, {
            "classes": ("wide",),
            "fields": ("employee_id", "full_name", "role", "department", "factory_code", "factory_name", "country_code", "country_name", "password1", "password2", "is_staff", "is_superuser"),
        }),
    )

    search_fields = ("employee_id", "full_name")
    ordering = ("employee_id",)  # <-- important fix
    filter_horizontal = ("groups", "user_permissions")

admin.site.register(Employee, EmployeeAdmin)



accounts/forms.py:


from django import forms
from .models import Employee

class EmployeeForm(forms.ModelForm):
    password = forms.CharField(widget=forms.PasswordInput, required=False)  # optional for edit

    class Meta:
        model = Employee
        fields = [
            'employee_id', 'full_name', 'role', 'department',
            'factory_code', 'factory_name', 'country_code', 'country_name', 'password'
        ]


accounts/views.py:


from django.shortcuts import render, redirect, get_object_or_404
from django.contrib.auth import authenticate, login, logout
from django.contrib.auth.decorators import login_required
from .forms import EmployeeForm
from .models import Employee
from django.http import HttpResponseForbidden
from django.conf import settings
import requests
import time
from django.http import HttpResponse, JsonResponse
import json
from django.views.decorators.csrf import csrf_exempt


# ----------------- Auth -----------------
def login_view(request):
    if request.method == "POST":
        employee_id = request.POST.get("employee_id")
        password = request.POST.get("password")

        user = authenticate(request, employee_id=employee_id, password=password)

        if user is not None:
            login(request, user)

            # ðŸ”¹ Role-based redirection
            if user.is_superuser or getattr(user, 'role', '').lower() == "admin" or getattr(user, 'role', '').upper() == "PQE":
                return redirect('dashboard')
            elif getattr(user, 'role', '').upper() == "IPQC":
                return redirect('ipqc_home')
            else:
                # Default redirect (if no role matches)
                return redirect('dashboard')

        else:
            return render(request, "accounts/login.html", {"error": "Invalid credentials"})

    return render(request, "accounts/login.html")

def logout_view(request):
    logout(request)
    return redirect('login')

# ----------------- Dashboard -----------------
@login_required
def dashboard(request):
    # Check if user is superuser or has role 'admin'
    
    if not (request.user.is_superuser or getattr(request.user, 'role', '').lower() == 'admin' or getattr(request.user, 'role', '').upper() == 'PQE'):
        return HttpResponseForbidden("You are not authorized to view this page.")

    total_employees = Employee.objects.count()

    context = {
        "total_employees": total_employees,
    }
    return render(request, "accounts/dashboard.html", context)

# ----------------- Employee CRUD -----------------
@login_required
def employee_list(request):
    employees = Employee.objects.all()
    return render(request, "accounts/employee_list.html", {"employees": employees})

@login_required
def employee_create(request):
    title = "Create"  # Add this so template can use {{ title }}
    
    if request.method == "POST":
        form = EmployeeForm(request.POST)
        if form.is_valid():
            data = form.cleaned_data
            Employee.objects.create_user(
                employee_id=data['employee_id'],
                full_name=data['full_name'],
                password=data['password'],
                role=data['role'],
                department=data['department'],
                factory_code=data['factory_code'],
                factory_name=data['factory_name'],
                country_code=data['country_code'],
                country_name=data['country_name']
            )
            return redirect('employee_list')
    else:
        form = EmployeeForm()
    
    return render(
        request,
        "accounts/employee_create.html",
        {
            "form": form,
            "title": title  # Pass title to template
        }
    )

@login_required
def employee_edit(request, pk):
    employee = get_object_or_404(Employee, pk=pk)
    if request.method == "POST":
        form = EmployeeForm(request.POST, instance=employee)
        if form.is_valid():
            emp = form.save(commit=False)
            password = form.cleaned_data.get('password')
            if password:
                emp.set_password(password)
            emp.save()
            return redirect('employee_list')
    else:
        form = EmployeeForm(instance=employee)
    return render(request, "accounts/employee_edit.html", {"form": form, "employee": employee})

@login_required
def employee_delete(request, pk):
    employee = get_object_or_404(Employee, pk=pk)
    
    if request.method == "POST":
        # User confirmed deletion
        employee.delete()
        return redirect('employee_list')
    
    # Render confirmation page
    return render(request, "accounts/employee_delete.html", {"employee": employee})



accounts/decoratores.py:

from functools import wraps
from django.shortcuts import redirect
from core.models import Page, Assignment

def access_control(url_pattern, allowed_roles=None, allowed_departments=None):
    """
    Decorator to restrict access based on role, department, and factory_code
    """
    def decorator(view_func):
        @wraps(view_func)
        def wrapper(request, *args, **kwargs):
            if not request.user.is_authenticated:
                return redirect("login")

            user_role = getattr(request.user, "role", None)
            user_department = getattr(request.user, "department", None)
            user_factory_code = getattr(request.user, "factory_code", None)

            try:
                page = Page.objects.get(url_pattern=url_pattern)
            except Page.DoesNotExist:
                return redirect("no_access")

            # Check if assignment exists for this user
            if not Assignment.objects.filter(factory_code=user_factory_code, department=user_department, role=user_role, page=page).exists():
                return redirect("no_access")

            request.page = page
            return view_func(request, *args, **kwargs)
        return wrapper
    return decorator


accounts/role_decorator.py:


from functools import wraps
from django.core.exceptions import PermissionDenied
from django.shortcuts import redirect
from django.contrib.auth.decorators import login_required
from django.contrib.auth.mixins import LoginRequiredMixin


# ==============================
# âœ… FUNCTION-BASED VIEW DECORATOR
# ==============================
def role_required(allowed_roles=None, redirect_url='/no-permission/'):
    """
    Decorator to restrict view access based on user roles.
    - Default: Only ADMIN and SUPERUSER can access.
    - Example: @role_required(["IPQC", "QA"])
    """
    if allowed_roles is None:
        allowed_roles = []  # Default empty means only admin/superuser allowed

    def decorator(view_func):
        @wraps(view_func)
        @login_required
        def _wrapped_view(request, *args, **kwargs):
            user = request.user

            # Allow Superuser or Admin by default
            user_role = getattr(user, 'role', '').upper()
            if user.is_superuser or user_role == 'ADMIN':
                return view_func(request, *args, **kwargs)

            # If role is defined and matches
            if allowed_roles and user_role in [r.upper() for r in allowed_roles]:
                return view_func(request, *args, **kwargs)

            # Access denied â†’ redirect to custom page or raise 403
            if redirect_url:
                return redirect(redirect_url)
            raise PermissionDenied

        return _wrapped_view
    return decorator


# ==============================
# âœ… CLASS-BASED VIEW MIXIN
# ==============================
class RoleRequiredMixin(LoginRequiredMixin):
    """
    Mixin for class-based views to restrict access based on user roles.
    Usage:
      - allowed_roles = ["IPQC", "QA"]
      - Default allows only ADMIN and SUPERUSER
    """
    allowed_roles = []  # Override in view
    redirect_url = '/no-permission/'

    def dispatch(self, request, *args, **kwargs):
        user = request.user

        if not user.is_authenticated:
            return self.handle_no_permission()

        user_role = getattr(user, 'role', '').upper()

        # Allow Admin and Superuser by default
        if user.is_superuser or user_role == "ADMIN":
            return super().dispatch(request, *args, **kwargs)

        # Check allowed roles if defined
        if self.allowed_roles:
            if user_role in [role.upper() for role in self.allowed_roles]:
                return super().dispatch(request, *args, **kwargs)

        # Access denied
        if self.redirect_url:
            return redirect(self.redirect_url)
        raise PermissionDenied


accounts/apps.py:

from django.apps import AppConfig


class AccountsConfig(AppConfig):
    default_auto_field = 'django.db.models.BigAutoField'
    name = 'accounts'


accounts/urls.py:

from django.urls import path
from . import views

urlpatterns = [
    path("login/", views.login_view, name="login"),
    path("logout/", views.logout_view, name="logout"),
    path("", views.dashboard, name="dashboard"),

    # Superuser Employee management
    path("employees/", views.employee_list, name="employee_list"),
    path("employees/create/", views.employee_create, name="employee_create"),
    path("employees/edit/<int:pk>/", views.employee_edit, name="employee_edit"),
    path("employees/delete/<int:pk>/", views.employee_delete, name="employee_delete"),
]



templates/accounts/dashboard.html:

	{% extends 'base.html' %}
	{% block title %}Account Home{% endblock %}
	{% block content %}
	<div class="space-y-6">
	    <!-- Header Stats -->
	    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
	        <!-- Total Employees -->
	        <div class="metric-card">
	            <div class="flex items-start justify-between">
	                <div>
	                    <div class="metric-value">{{ total_employees }}</div>
	                    <div class="metric-label">Total Employees</div>
	                </div>
	                <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
	                    <i class="fas fa-users text-blue-600 text-xl"></i>
	                </div>
	            </div>
	        </div>
	        <!-- Active Users -->
	        <div class="metric-card">
	            <div class="flex items-start justify-between">
	                <div>
	                    <div class="metric-value">{{ total_employees }}</div>
	                    <div class="metric-label">Active Now</div>
	                    <div class="metric-change positive">
	                        <i class="fas fa-circle text-xs mr-1"></i>All online
	                    </div>
	                </div>
	                <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center">
	                    <i class="fas fa-user-check text-green-600 text-xl"></i>
	                </div>
	            </div>
	        </div>
	        <!-- Today's Activity -->
	        <div class="metric-card">
	            <div class="flex items-start justify-between">
	                <div>
	                    <div class="metric-value">{{ today_records }}</div>
	                    <div class="metric-label">Today's Activity</div>
	                    <div class="metric-change positive">
	                        <i class="fas fa-arrow-up mr-1"></i>Records
	                    </div>
	                </div>
	                <div class="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center">
	                    <i class="fas fa-chart-line text-purple-600 text-xl"></i>
	                </div>
	            </div>
	        </div>
	        <!-- System Status -->
	        <div class="metric-card">
	            <div class="flex items-start justify-between">
	                <div>
	                    <div class="metric-value">Online</div>
	                    <div class="metric-label">System Status</div>
	                    <div class="metric-change positive">
	                        <i class="fas fa-check-circle mr-1"></i>Operational
	                    </div>
	                </div>
	                <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center">
	                    <i class="fas fa-server text-green-600 text-xl"></i>
	                </div>
	            </div>
	        </div>
	    </div>
	    <!-- Quick Actions -->
	    <div class="bg-white rounded-xl p-6 border border-gray-200 shadow-sm">
	        <h2 class="text-lg font-bold mb-6 text-gray-900">
	            <i class="fas fa-rocket mr-2 text-blue-500"></i>
	            Quick Actions
	        </h2>
	        <div class="grid grid-cols-2 lg:grid-cols-4 gap-4">
	            <a href="{% url 'employee_create' %}" class="quick-action">
	                <i class="fas fa-user-plus text-blue-500"></i>
	                <div class="label">Add Employee</div>
	                <div class="desc">Create new employee</div>
	            </a>
	            <a href="{% url 'create_dynamic_form' %}" class="quick-action">
	                <i class="fas fa-wpforms text-purple-500"></i>
	                <div class="label">Create Form</div>
	                <div class="desc">Design new form</div>
	            </a>
	            <a href="#" class="quick-action">
	                <i class="fas fa-download text-green-500"></i>
	                <div class="label">Export Data</div>
	                <div class="desc">Download reports</div>
	            </a>
	            <a href="#" class="quick-action">
	                <i class="fas fa-cog text-gray-500"></i>
	                <div class="label">Settings</div>
	                <div class="desc">System configuration</div>
	            </a>
	        </div>
	    </div>
	    <!-- Recent Activity -->
	    <div class="bg-white rounded-xl p-6 border border-gray-200 shadow-sm">
	        <h2 class="text-lg font-bold mb-6 text-gray-900">
	            <i class="fas fa-history mr-2 text-purple-500"></i>
	            Recent Activity
	        </h2>
	        <div class="space-y-4">
	            {% for activity in recent_activities %}
	                <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors border border-gray-200">
	                    <div class="flex items-center">
	                        <div class="w-3 h-3 bg-{{ activity.color|default:'blue' }}-500 rounded-full"></div>
	                        <div class="ml-4">
	                            <p class="text-sm font-medium text-gray-900">{{ activity.title }}</p>
	                            <p class="text-xs text-gray-500">{{ activity.timestamp }}</p>
	                        </div>
	                    </div>
	                    <span class="text-xs font-medium px-2 py-1 bg-gray-200 text-gray-700 rounded-full">
	                        {{ activity.status }}
	                    </span>
	                </div>
	            {% empty %}
	                <div class="text-center py-8 text-gray-500">
	                    <i class="fas fa-inbox text-4xl mb-3 block text-gray-300"></i>
	                    <div class="text-lg font-medium">No recent activity</div>
	                    <div class="text-sm mt-1">Check back later for updates</div>
	                </div>
	            {% endfor %}
	        </div>
	    </div>
	</div>
	{% endblock %}


templates/accounts/employee_create.html:


{% extends 'base.html' %}
{% block title %}Add New Employee{% endblock %}

{% block content %}
<div class="space-y-6">
    <!-- Header -->
    <div class="text-center mb-8">
        <h1 class="text-2xl font-bold text-gray-900">
            <i class="fas fa-user-plus mr-3 text-blue-500"></i>
            Add New Employee
        </h1>
        <p class="text-gray-600 mt-2">Create a new user account for the manufacturing system</p>
    </div>

    <!-- Creation Form -->
    <div class="bg-white rounded-xl p-6 border border-gray-200 shadow-sm">
        <form method="post" class="space-y-6">
            {% csrf_token %}
            
            <!-- Personal Information -->
            <div class="bg-gray-50 rounded-lg p-6 border border-gray-200">
                <h2 class="text-lg font-bold mb-4 text-gray-900">
                    <i class="fas fa-id-card mr-2 text-blue-500"></i>
                    Personal Information
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Employee ID *</label>
                        <input type="text" name="employee_id" required
                               class="w-full px-3 py-2 bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-gray-900"
                               placeholder="Enter unique employee ID">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Full Name *</label>
                        <input type="text" name="full_name" required
                               class="w-full px-3 py-2 bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-gray-900"
                               placeholder="Enter full name">
                    </div>
                </div>
            </div>

            <!-- Job Information -->
            <div class="bg-gray-50 rounded-lg p-6 border border-gray-200">
                <h2 class="text-lg font-bold mb-4 text-gray-900">
                    <i class="fas fa-briefcase mr-2 text-purple-500"></i>
                    Job Information
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Role *</label>
                        <select name="role" required
                                class="w-full px-3 py-2 bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-gray-900">
                            <option value="">Select Role</option>
                            <option value="IPQC">IPQC</option>
                            <option value="QA">QA</option>
                            <option value="Admin">Admin</option>
                            <option value="Supervisor">Supervisor</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Department *</label>
                        <input type="text" name="department" required
                               class="w-full px-3 py-2 bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-gray-900"
                               placeholder="Enter department">
                    </div>
                </div>
            </div>

            <!-- Factory Information -->
            <div class="bg-gray-50 rounded-lg p-6 border border-gray-200">
                <h2 class="text-lg font-bold mb-4 text-gray-900">
                    <i class="fas fa-industry mr-2 text-green-500"></i>
                    Factory Information
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Factory Code *</label>
                        <input type="text" name="factory_code" required
                               class="w-full px-3 py-2 bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-gray-900"
                               placeholder="Enter factory code">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Factory Name *</label>
                        <input type="text" name="factory_name" required
                               class="w-full px-3 py-2 bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-gray-900"
                               placeholder="Enter factory name">
                    </div>
                </div>
            </div>

            <!-- Location Information -->
            <div class="bg-gray-50 rounded-lg p-6 border border-gray-200">
                <h2 class="text-lg font-bold mb-4 text-gray-900">
                    <i class="fas fa-globe mr-2 text-blue-500"></i>
                    Location Information
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Country Code *</label>
                        <input type="text" name="country_code" required
                               class="w-full px-3 py-2 bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-gray-900"
                               placeholder="Enter country code">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Country Name *</label>
                        <input type="text" name="country_name" required
                               class="w-full px-3 py-2 bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-gray-900"
                               placeholder="Enter country name">
                    </div>
                </div>
            </div>

            <!-- System Permissions -->
            <div class="bg-gray-50 rounded-lg p-6 border border-gray-200">
                <h2 class="text-lg font-bold mb-4 text-gray-900">
                    <i class="fas fa-shield-alt mr-2 text-orange-500"></i>
                    System Permissions
                </h2>
                <div class="space-y-4">
                    <div class="flex items-center">
                        <input type="checkbox" name="is_active" checked
                               class="w-4 h-4 text-blue-600 bg-white border-gray-300 rounded focus:ring-blue-500">
                        <label class="ml-2 text-sm text-gray-700">Active Employee</label>
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" name="is_staff" 
                               class="w-4 h-4 text-blue-600 bg-white border-gray-300 rounded focus:ring-blue-500">
                        <label class="ml-2 text-sm text-gray-700">Staff Access</label>
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" name="is_superuser" 
                               class="w-4 h-4 text-blue-600 bg-white border-gray-300 rounded focus:ring-blue-500">
                        <label class="ml-2 text-sm text-gray-700">Superuser Access</label>
                    </div>
                </div>
            </div>

            <!-- Password -->
            <div class="bg-gray-50 rounded-lg p-6 border border-gray-200">
                <h2 class="text-lg font-bold mb-4 text-gray-900">
                    <i class="fas fa-key mr-2 text-pink-500"></i>
                    Security Credentials
                </h2>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Password *</label>
                        <input type="password" name="password" required
                               class="w-full px-3 py-2 bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-gray-900"
                               placeholder="Enter secure password">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Confirm Password *</label>
                        <input type="password" name="password2" required
                               class="w-full px-3 py-2 bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-gray-900"
                               placeholder="Confirm password">
                    </div>
                </div>
                <div class="text-xs text-gray-500 mt-2">
                    <i class="fas fa-info-circle mr-1"></i>
                    Password must be at least 8 characters with uppercase, lowercase, numbers and special characters
                </div>
            </div>

            <!-- Submit Button -->
            <div class="flex justify-center pt-4">
                <button type="submit" 
                        class="btn btn-primary px-8 py-3">
                    <i class="fas fa-user-plus mr-2"></i>
                    Create Employee Account
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}


templates/accounts/employee_edit.html:

{% extends 'base.html' %}
{% block title %}Edit Employee{% endblock %}

{% block content %}
<div class="space-y-6">
    <!-- Header -->
    <div class="mb-6">
        <div class="flex items-center justify-between">
            <div>
                <h1 class="text-2xl font-bold text-gray-900">
                    <i class="fas fa-user-edit mr-3 text-blue-500"></i>
                    Edit Employee: {{ employee.full_name }}
                </h1>
                <p class="text-gray-600 mt-1">Update employee information and permissions</p>
            </div>
            <a href="{% url 'employee_list' %}" class="btn btn-secondary">
                <i class="fas fa-arrow-left mr-2"></i>
                Back to List
            </a>
        </div>
    </div>

    <!-- Edit Form -->
    <div class="bg-white rounded-xl p-6 border border-gray-200 shadow-sm">
        <form method="post" class="space-y-6">
            {% csrf_token %}
            
            <!-- Personal Information -->
            <div class="bg-gray-50 rounded-lg p-6 border border-gray-200">
                <h2 class="text-lg font-bold mb-4 text-gray-900">
                    <i class="fas fa-id-card mr-2 text-blue-500"></i>
                    Personal Information
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Employee ID</label>
                        <input type="text" name="employee_id" value="{{ employee.employee_id }}" required
                               class="w-full px-3 py-2 bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-gray-900">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Full Name</label>
                        <input type="text" name="full_name" value="{{ employee.full_name }}" required
                               class="w-full px-3 py-2 bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-gray-900">
                    </div>
                </div>
            </div>

            <!-- Job Information -->
            <div class="bg-gray-50 rounded-lg p-6 border border-gray-200">
                <h2 class="text-lg font-bold mb-4 text-gray-900">
                    <i class="fas fa-briefcase mr-2 text-purple-500"></i>
                    Job Information
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Role</label>
                        <select name="role" required
                                class="w-full px-3 py-2 bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-gray-900">
                            <option value="">Select Role</option>
                            <option value="IPQC" {% if employee.role == 'IPQC' %}selected{% endif %}>IPQC</option>
                            <option value="QA" {% if employee.role == 'QA' %}selected{% endif %}>QA</option>
                            <option value="Admin" {% if employee.role == 'Admin' %}selected{% endif %}>Admin</option>
                            <option value="Supervisor" {% if employee.role == 'Supervisor' %}selected{% endif %}>Supervisor</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Department</label>
                        <input type="text" name="department" value="{{ employee.department }}" required
                               class="w-full px-3 py-2 bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-gray-900">
                    </div>
                </div>
            </div>

            <!-- Factory Information -->
            <div class="bg-gray-50 rounded-lg p-6 border border-gray-200">
                <h2 class="text-lg font-bold mb-4 text-gray-900">
                    <i class="fas fa-industry mr-2 text-green-500"></i>
                    Factory Information
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Factory Code</label>
                        <input type="text" name="factory_code" value="{{ employee.factory_code }}" required
                               class="w-full px-3 py-2 bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-gray-900">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Factory Name</label>
                        <input type="text" name="factory_name" value="{{ employee.factory_name }}" required
                               class="w-full px-3 py-2 bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-gray-900">
                    </div>
                </div>
            </div>

            <!-- Location Information -->
            <div class="bg-gray-50 rounded-lg p-6 border border-gray-200">
                <h2 class="text-lg font-bold mb-4 text-gray-900">
                    <i class="fas fa-globe mr-2 text-blue-500"></i>
                    Location Information
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Country Code</label>
                        <input type="text" name="country_code" value="{{ employee.country_code }}" required
                               class="w-full px-3 py-2 bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-gray-900">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Country Name</label>
                        <input type="text" name="country_name" value="{{ employee.country_name }}" required
                               class="w-full px-3 py-2 bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-gray-900">
                    </div>
                </div>
            </div>

            <!-- System Permissions -->
            <div class="bg-gray-50 rounded-lg p-6 border border-gray-200">
                <h2 class="text-lg font-bold mb-4 text-gray-900">
                    <i class="fas fa-shield-alt mr-2 text-orange-500"></i>
                    System Permissions
                </h2>
                <div class="space-y-4">
                    <div class="flex items-center">
                        <input type="checkbox" name="is_active" {% if employee.is_active %}checked{% endif %} 
                               class="w-4 h-4 text-blue-600 bg-white border-gray-300 rounded focus:ring-blue-500">
                        <label class="ml-2 text-sm text-gray-700">Active Employee</label>
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" name="is_staff" {% if employee.is_staff %}checked{% endif %} 
                               class="w-4 h-4 text-blue-600 bg-white border-gray-300 rounded focus:ring-blue-500">
                        <label class="ml-2 text-sm text-gray-700">Staff Access</label>
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" name="is_superuser" {% if employee.is_superuser %}checked{% endif %} 
                               class="w-4 h-4 text-blue-600 bg-white border-gray-300 rounded focus:ring-blue-500">
                        <label class="ml-2 text-sm text-gray-700">Superuser Access</label>
                    </div>
                </div>
            </div>

            <!-- Password Section -->
            <div class="bg-gray-50 rounded-lg p-6 border border-gray-200">
                <h2 class="text-lg font-bold mb-4 text-gray-900">
                    <i class="fas fa-key mr-2 text-pink-500"></i>
                    Password Management
                </h2>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">New Password</label>
                        <input type="password" name="password" 
                               class="w-full px-3 py-2 bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-gray-900"
                               placeholder="Leave blank to keep current password">
                    </div>
                    <div class="text-xs text-gray-500">
                        <i class="fas fa-info-circle mr-1"></i>
                        Leave blank to keep current password. Enter new password only if you want to change it.
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 pt-4">
                <button type="submit" 
                        class="btn btn-primary">
                    <i class="fas fa-save mr-2"></i>
                    Update Employee
                </button>
                <a href="{% url 'employee_list' %}" 
                   class="btn btn-secondary">
                    <i class="fas fa-times mr-2"></i>
                    Cancel
                </a>
            </div>
        </form>
    </div>
</div>
{% endblock %}



templates/accounts/employee_list.html:

	{% extends 'base.html' %}
	{% block title %}Employee Management{% endblock %}
	{% block content %}
	<div class="space-y-6">
	    <!-- Header -->
	    <div class="mb-6">
	        <div class="flex items-center justify-between">
	            <div>
	                <h1 class="text-2xl font-bold text-gray-900">
	                    <i class="fas fa-users mr-3 text-blue-500"></i>
	                    Employee Management
	                </h1>
	                <p class="text-gray-600 mt-1">Manage employee accounts and permissions</p>
	            </div>
	            <a href="{% url 'employee_create' %}" class="btn btn-primary">
	                <i class="fas fa-user-plus mr-2"></i>
	                Add New Employee
	            </a>
	        </div>
	    </div>
	    <!-- Search Bar -->
	    <div class="bg-white rounded-xl p-6 border border-gray-200 shadow-sm">
	        <div class="flex items-center space-x-4">
	            <div class="flex-1 relative">
	                <input type="text" id="searchInput" placeholder="Search employees..." 
	                       class="w-full px-4 py-3 bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-gray-900 pl-10"
	                       onkeyup="filterTable()">
	                <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
	            </div>
	            <button class="btn btn-secondary">
	                <i class="fas fa-filter"></i>
	            </button>
	        </div>
	    </div>
	    <!-- Employee Table -->
	    <div class="bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden">
	        <div class="overflow-x-auto">
	            <table class="w-full" id="employeeTable">
	                <thead class="bg-gray-50 border-b border-gray-200">
	                    <tr>
	                        <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">
	                            <i class="fas fa-hashtag mr-1"></i> ID
	                        </th>
	                        <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Name</th>
	                        <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Role</th>
	                        <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Department</th>
	                        <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Factory</th>
	                        <th class="px-4 py-3 text-center text-xs font-semibold text-gray-600 uppercase tracking-wider">Status</th>
	                        <th class="px-4 py-3 text-center text-xs font-semibold text-gray-600 uppercase tracking-wider">Actions</th>
	                    </tr>
	                </thead>
	                <tbody class="divide-y divide-gray-200">
	                    {% for employee in employees %}
	                        <tr class="hover:bg-gray-50 transition-colors">
	                            <td class="px-4 py-3 text-sm font-mono text-gray-900">{{ employee.employee_id }}</td>
	                            <td class="px-4 py-3 text-sm text-gray-900">
	                                <div class="flex items-center">
	                                    <div class="w-2 h-2 bg-{{ employee.is_active|yesno:'green' }}-500 rounded-full mr-2"></div>
	                                    {{ employee.full_name }}
	                                </div>
	                            </td>
	                            <td class="px-4 py-3 text-sm text-gray-900">
	                                <span class="status-badge status-idle">{{ employee.role }}</span>
	                            </td>
	                            <td class="px-4 py-3 text-sm text-gray-900">{{ employee.department }}</td>
	                            <td class="px-4 py-3 text-sm text-gray-900">{{ employee.factory_code }}</td>
	                            <td class="px-4 py-3 text-center">
	                                {% if employee.is_active %}
	                                    <span class="status-badge status-running">Active</span>
	                                {% else %}
	                                    <span class="status-badge status-stop">Inactive</span>
	                                {% endif %}
	                            </td>
	                            <td class="px-4 py-3 text-center">
	                                <div class="flex items-center justify-center space-x-2">
	                                    <a href="{% url 'employee_edit' employee.id %}" 
	                                       class="text-blue-600 hover:text-blue-800 transition-colors"
	                                       title="Edit Employee">
	                                        <i class="fas fa-edit"></i>
	                                    </a>
	                                    <a href="{% url 'employee_delete' employee.id %}" 
	                                       class="text-red-600 hover:text-red-800 transition-colors"
	                                       title="Delete Employee"
	                                       onclick="return confirm('Delete {{ employee.full_name }}?')">
	                                        <i class="fas fa-trash"></i>
	                                    </a>
	                                </div>
	                            </td>
	                        </tr>
	                    {% empty %}
	                        <tr>
	                            <td colspan="7" class="px-4 py-12 text-center text-gray-500">
	                                <i class="fas fa-inbox text-4xl mb-3 block text-gray-300"></i>
	                                <div class="text-lg font-medium">No employees found</div>
	                                <div class="text-sm mt-1">Create your first employee to get started</div>
	                            </td>
	                        </tr>
	                    {% endfor %}
	                </tbody>
	            </table>
	        </div>
	    </div>
	</div>
	<script>
	    function filterTable() {
	        const input = document.getElementById('searchInput');
	        const filter = input.value.toLowerCase();
	        const rows = document.querySelectorAll('#employeeTable tbody tr');
	        rows.forEach(row => {
	            const text = row.textContent.toLowerCase();
	            if (text.includes(filter)) {
	                row.style.display = '';
	            } else {
	                row.style.display = 'none';
	            }
	        });
	    }
	</script>
	{% endblock %}

templates/accounts/login.html:


<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transs Flow - Manufacturing Control</title>
    <link rel="manifest" href="/static/manifest.json">
    <meta name="theme-color" content="#0ea5e9">
    <link rel="apple-touch-icon" href="/static/icons/apple-touch-icon.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ====== CSS Variables ====== */
        :root {
            --primary: #0ea5e9;
            --primary-dark: #0284c7;
            --success: #22c55e;
            --warning: #f59e0b;
            --danger: #ef4444;
            --dark: #1e293b;
            --darker: #0f172a;
            --text-primary: #1e293b;
            --text-secondary: #475569;
            --text-light: #64748b;
            --light: #f8fafc;
            --bg-primary: #ffffff;
            --bg-secondary: #f8fafc;
            --border: #cbd5e1;
            --sidebar-width: 280px;
            --header-height: 73px;
            --transition-speed: 0.3s;
        }

        /* ====== Base Styles ====== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--bg-secondary);
            color: var(--text-primary);
            overflow-x: hidden;
            font-size: 15px;
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background-image: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-primary) 100%);
        }

        /* ====== Login Container ====== */
        .login-container {
            width: 100%;
            max-width: 450px;
            padding: 2rem;
        }

        .login-card {
            background: var(--bg-primary);
            border-radius: 16px;
            padding: 2.5rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            border: 1px solid var(--border);
            position: relative;
            overflow: hidden;
        }

        .login-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary) 0%, var(--primary-dark) 100%);
        }

        /* ====== Logo Section ====== */
        .logo-section {
            text-align: center;
            margin-bottom: 2rem;
        }

        .logo {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            border-radius: 20px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 1rem;
            box-shadow: 0 8px 20px rgba(14, 165, 233, 0.25);
        }

        .logo i {
            font-size: 2.5rem;
            color: white;
        }

        .app-title {
            font-size: 1.8rem;
            font-weight: 800;
            color: var(--dark);
            margin-bottom: 0.5rem;
        }

        .app-subtitle {
            color: var(--text-secondary);
            font-size: 0.9rem;
            font-weight: 500;
        }

        /* ====== Form Styles ====== */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--text-primary);
            font-size: 0.9rem;
        }

        .form-input {
            width: 100%;
            padding: 0.875rem 1rem;
            border: 2px solid var(--border);
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: var(--bg-primary);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.2);
        }

        .input-icon {
            position: relative;
        }

        .input-icon i {
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-light);
        }

        /* ====== Button Styles ====== */
        .btn-login {
            width: 100%;
            padding: 1rem;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(14, 165, 233, 0.3);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-login:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(14, 165, 233, 0.4);
        }

        .btn-login:active {
            transform: translateY(0);
        }

        /* ====== Alert Styles ====== */
        .alert-error {
            background: #fee2e2;
            border: 1px solid #fecaca;
            color: #b91c1c;
            padding: 1rem;
            border-radius: 10px;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        /* ====== Footer ====== */
        .login-footer {
            text-align: center;
            margin-top: 2rem;
            color: var(--text-light);
            font-size: 0.85rem;
        }

        .login-footer a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 500;
        }

        .login-footer a:hover {
            text-decoration: underline;
        }

        /* ====== Animations ====== */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.6s ease-out;
        }

        /* ====== Responsive Design ====== */
        @media (max-width: 480px) {
            .login-container {
                padding: 1rem;
            }
            
            .login-card {
                padding: 1.5rem;
            }
            
            .logo {
                width: 60px;
                height: 60px;
            }
            
            .logo i {
                font-size: 2rem;
            }
            
            .app-title {
                font-size: 1.5rem;
            }
        }

        /* ====== Focus Styles for Accessibility ====== */
        button:focus,
        input:focus {
            outline: 2px solid var(--primary);
            outline-offset: 2px;
        }
    </style>
</head>
<body>
    <div class="login-container fade-in">
        <div class="login-card">
            <!-- Logo Section -->
            <div class="logo-section">
                <div class="logo">
                    <i class="fas fa-industry"></i>
                </div>
                <h1 class="app-title">Transs Flow</h1>
                <p class="app-subtitle">Manufacturing Control System</p>
            </div>

            <!-- Login Form -->
            <form method="post">
                {% csrf_token %}
                
                <!-- Error Message -->
                {% if error %}
                <div class="alert-error">
                    <i class="fas fa-exclamation-circle"></i>
                    <span>{{ error }}</span>
                </div>
                {% endif %}
                
                <!-- Employee ID -->
                <div class="form-group">
                    <label for="employee_id" class="form-label">
                        <i class="fas fa-id-badge mr-2"></i>Employee ID
                    </label>
                    <div class="input-icon">
                        <input type="text" 
                               id="employee_id" 
                               name="employee_id" 
                               class="form-input" 
                               placeholder="Enter your employee ID"
                               required>
                        <i class="fas fa-user"></i>
                    </div>
                </div>
                
                <!-- Password -->
                <div class="form-group">
                    <label for="password" class="form-label">
                        <i class="fas fa-lock mr-2"></i>Password
                    </label>
                    <div class="input-icon">
                        <input type="password" 
                               id="password" 
                               name="password" 
                               class="form-input" 
                               placeholder="Enter your password"
                               required>
                        <i class="fas fa-eye-slash" id="togglePassword"></i>
                    </div>
                </div>
                
                <!-- Remember Me -->
                <div class="form-group">
                    <label class="flex items-center gap-2">
                        <input type="checkbox" class="form-checkbox">
                        <span class="text-sm">Remember me</span>
                    </label>
                </div>
                
                <!-- Submit Button -->
                <button type="submit" class="btn-login">
                    <i class="fas fa-sign-in-alt mr-2"></i>
                    Sign In
                </button>
            </form>

            <!-- Footer -->
            <div class="login-footer">
                <p>Â© 2025 Transs Industries. All rights reserved.</p>
                <p class="mt-2">
                    <a href="#">Forgot Password?</a> | 
                    <a href="#">Help & Support</a>
                </p>
            </div>
        </div>
    </div>

    <script>
        if ('serviceWorker' in navigator) {

        // Password visibility toggle
        const togglePassword = document.getElementById('togglePassword');
        const passwordInput = document.getElementById('password');
        
        togglePassword.addEventListener('click', function() {
            const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
            passwordInput.setAttribute('type', type);
            
            // Toggle icon
            this.classList.toggle('fa-eye');
            this.classList.toggle('fa-eye-slash');
        });

        // Form submission animation
        const loginForm = document.querySelector('form');
        loginForm.addEventListener('submit', function() {
            const submitBtn = document.querySelector('.btn-login');
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Authenticating...';
            submitBtn.disabled = true;
        });

        // Input focus effects
        const inputs = document.querySelectorAll('.form-input');
        inputs.forEach(input => {
            input.addEventListener('focus', function() {
                this.parentElement.querySelector('i').style.color = 'var(--primary)';
            });
            
            input.addEventListener('blur', function() {
                this.parentElement.querySelector('i').style.color = 'var(--text-light)';
            });
        });
    </script>
</body>
</html>


templates/base.html:

{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <!-- Viewport + safe-area for notches -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Transs Flow - Manufacturing Control</title>

    <!-- PWA / Mobile meta -->
    <meta name="theme-color" content="#0ea5e9" />
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="manifest" href="{% static 'manifest.json' %}">
    <link rel="apple-touch-icon" href="{% static 'icons/apple-touch-icon.png' %}">
    
    <!-- Microsoft Tiles -->
    <meta name="msapplication-TileColor" content="#0ea5e9">
    <meta name="msapplication-config" content="{% static 'browserconfig.xml' %}">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="{% static 'screenshots/favicon.png' %}">

    <!-- Tailwind (CDN) -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* ====== CSS Variables ====== */
        :root {
            --primary: #0ea5e9;
            --primary-dark: #0284c7;
            --success: #22c55e;
            --warning: #f59e0b;
            --danger: #ef4444;
            --dark: #1e293b;
            --darker: #0f172a;
            --text-primary: #1e293b;
            --text-secondary: #475569;
            --text-light: #64748b;
            --light: #f8fafc;
            --bg-primary: #ffffff;
            --bg-secondary: #f8fafc;
            --border: #cbd5e1;
            --sidebar-width: 280px;
            --header-height: 73px;
            --transition-speed: 0.3s;
        }

        /* ====== Base Styles ====== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html,
        body {
            height: 100%;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--bg-secondary);
            color: var(--text-primary);
            overflow-x: hidden;
            font-size: 15px;
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            padding-bottom: env(safe-area-inset-bottom);
            /* safe area for iOS */
        }

        /* ====== PWA Loading Screen ====== */
        .pwa-loading {
            position: fixed;
            inset: 0;
            background: var(--bg-primary);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 0.3s ease;
        }

        .pwa-loading.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .pwa-logo {
            width: 80px;
            height: 80px;
            background: var(--primary);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        /* ====== Header ====== */
        .header {
            background: var(--bg-primary);
            border-bottom: 2px solid var(--border);
            position: sticky;
            top: 0;
            z-index: 60;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            height: var(--header-height);
        }

        /* App shell: full height column layout */
        .app-shell {
            min-height: calc(100vh - var(--header-height));
            display: flex;
            flex-direction: column;
        }

        /* ====== Layout Structure ====== */
        .app-container {
            display: flex;
            flex: 1;
            min-height: calc(100vh - var(--header-height));
        }

        .sidebar {
            background: var(--bg-primary);
            border-right: 1px solid var(--border);
            width: var(--sidebar-width);
            flex-shrink: 0;
            transition: transform var(--transition-speed) ease, opacity var(--transition-speed) ease;
            overflow-y: auto;
            z-index: 50;
        }

        .main-content {
            flex: 1;
            padding: 1rem;
            transition: margin-left var(--transition-speed) ease;
            overflow-x: hidden;
        }

        /* ====== Mobile Sidebar ====== */
        @media (max-width: 1023px) {
            .sidebar {
                position: fixed;
                left: 0;
                top: var(--header-height);
                height: calc(100vh - var(--header-height));
                transform: translateX(-100%);
                opacity: 0;
                box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
            }

            .sidebar.active {
                transform: translateX(0);
                opacity: 1;
            }

            .main-content {
                margin-left: 0 !important;
            }

            /* When sidebar is open, keep main hidden to mimic native app behavior */
            .sidebar.active~.main-content {
                display: none;
            }
        }

        /* ====== Desktop Sidebar Toggle ====== */
        @media (min-width: 1024px) {
            .sidebar.collapsed {
                transform: translateX(-100%);
                margin-right: calc(-1 * var(--sidebar-width));
            }

            .sidebar.collapsed~.main-content {
                margin-left: 0;
            }

            .main-content {
                margin-left: 0;
            }
        }

        .sidebar-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 45;
            opacity: 0;
            pointer-events: none;
            transition: opacity var(--transition-speed) ease;
        }

        .sidebar-overlay.active {
            opacity: 1;
            pointer-events: auto;
        }

        /* ====== User Dropdown ====== */
        .user-dropdown {
            position: relative;
        }

        .user-dropdown-toggle {
            cursor: pointer;
            transition: all 0.2s ease;
            border-radius: 8px;
            padding: 6px 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .user-dropdown-toggle:hover {
            background: var(--bg-secondary);
        }

        .user-dropdown-menu {
            position: absolute;
            top: calc(100% + 8px);
            right: 0;
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.12);
            min-width: 220px;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.18s ease;
            z-index: 100;
        }

        .user-dropdown.active .user-dropdown-menu {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .user-dropdown-header {
            padding: 12px 16px;
            border-bottom: 1px solid var(--border);
            background: #f8fafc;
            border-radius: 12px 12px 0 0;
        }

        .user-dropdown-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            color: var(--text-secondary);
            text-decoration: none;
            transition: all 0.16s ease;
            font-weight: 600;
        }

        .user-dropdown-item:hover {
            background: var(--bg-secondary);
            color: var(--primary);
        }

        .user-dropdown-item i {
            width: 18px;
            text-align: center;
            font-size: 14px;
        }

        .user-dropdown-divider {
            height: 1px;
            background: var(--border);
            margin: 4px 0;
        }

        .user-dropdown-item.logout {
            color: var(--danger);
        }

        .user-dropdown-item.logout:hover {
            background: #fee2e2;
            color: #b91c1c;
        }

        /* ====== Navigation Items ====== */
        .nav-item {
            display: flex;
            align-items: center;
            padding: 14px 18px;
            color: var(--text-secondary);
            text-decoration: none;
            border-left: 4px solid transparent;
            transition: all 0.16s ease;
            font-weight: 600;
            position: relative;
            gap: 12px;
        }

        .nav-item:hover {
            background: var(--bg-secondary);
            color: var(--primary);
            border-left-color: var(--primary);
        }

        .nav-item.active {
            background: #eff6ff;
            color: var(--primary-dark);
            border-left-color: var(--primary);
            font-weight: 700;
        }

        .nav-item i {
            width: 22px;
            margin-right: 6px;
            font-size: 16px;
        }

        /* ====== Status Badges ====== */
        .status-badge {
            display: inline-flex;
            align-items: center;
            padding: 6px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-running {
            background: #dcfce7;
            color: #15803d;
            border: 1px solid #86efac;
        }

        .status-idle {
            background: #fef3c7;
            color: #a16207;
            border: 1px solid #fcd34d;
        }

        .status-stop {
            background: #fee2e2;
            color: #b91c1c;
            border: 1px solid #fca5a5;
        }

        /* ====== Metric Cards ====== */
        .metric-card {
            background: var(--bg-primary);
            border-radius: 12px;
            padding: 16px;
            border: 1px solid var(--border);
            transition: all 0.18s ease;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.04);
            min-height: 96px;
        }

        .metric-card:hover {
            box-shadow: 0 10px 30px rgba(2, 132, 199, 0.06);
            transform: translateY(-4px);
            border-color: rgba(14, 165, 233, 0.2);
        }

        .metric-value {
            font-size: 28px;
            font-weight: 800;
            color: var(--text-primary);
            line-height: 1;
            margin-bottom: 6px;
        }

        .metric-label {
            color: var(--text-secondary);
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.6px;
        }

        .metric-change {
            display: inline-flex;
            align-items: center;
            font-size: 12px;
            font-weight: 700;
            margin-top: 10px;
            padding: 6px 10px;
            border-radius: 999px;
        }

        .metric-change.positive {
            background: #dcfce7;
            color: #15803d;
        }

        .metric-change.negative {
            background: #fee2e2;
            color: #b91c1c;
        }

        /* ====== Quick Actions ====== */
        .quick-action {
            background: var(--bg-primary);
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 16px 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.18s ease;
            text-decoration: none;
            color: var(--text-primary);
            font-weight: 700;
            min-height: 88px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        .quick-action:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
            transform: translateY(-4px);
            box-shadow: 0 10px 30px rgba(14, 165, 233, 0.2);
        }

        .quick-action i {
            font-size: 22px;
        }

        .quick-action .label {
            font-weight: 800;
            font-size: 14px;
        }

        .quick-action .desc {
            font-size: 12px;
            opacity: 0.85;
        }

        /* ====== Production Table ====== */
        .production-table {
            background: var(--bg-primary);
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid var(--border);
            box-shadow: 0 1px 4px rgba(2, 6, 23, 0.03);
        }

        .table-row {
            display: flex;
            padding: 14px;
            border-bottom: 1px solid #f1f5f9;
            align-items: center;
            transition: background 0.12s ease;
        }

        .table-row:hover {
            background: var(--bg-secondary);
        }

        .table-header {
            background: #f1f5f9;
            font-weight: 800;
            color: var(--text-secondary);
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            padding: 12px 16px;
        }

        .table-cell {
            flex: 1;
            min-width: 0;
            font-weight: 700;
        }

        .table-cell.w-20 {
            flex: 0 0 20%;
        }

        .table-cell.w-15 {
            flex: 0 0 15%;
        }

        /* ====== Buttons ====== */
        .btn {
            padding: 10px 14px;
            border-radius: 8px;
            font-weight: 700;
            font-size: 13px;
            border: none;
            cursor: pointer;
            transition: all 0.14s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
            min-height: 44px;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
            box-shadow: 0 6px 16px rgba(14, 165, 233, 0.16);
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: var(--bg-primary);
            color: var(--text-secondary);
            border: 2px solid var(--border);
        }

        .btn-secondary:hover {
            background: var(--bg-secondary);
            border-color: var(--primary);
            color: var(--primary);
        }

        /* ====== Mobile Toggle Button ====== */
        .mobile-sidebar-toggle {
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--bg-primary);
            border: 2px solid var(--border);
            color: var(--text-secondary);
            width: 44px;
            height: 44px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.12s ease;
        }

        .mobile-sidebar-toggle:hover {
            background: var(--bg-secondary);
            border-color: var(--primary);
            color: var(--primary);
        }

        /* Show mobile toggle only on mobile/tablet */
        @media (min-width: 1024px) {
            .mobile-sidebar-toggle {
                display: none;
            }
        }

        /* ====== Desktop Toggle Button ====== */
        .desktop-sidebar-toggle {
            position: fixed;
            left: 20px;
            bottom: 20px;
            z-index: 55;
            background: var(--primary);
            color: white;
            width: 48px;
            height: 48px;
            border-radius: 50%;
            display: none;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 6px 18px rgba(14, 165, 233, 0.18);
            transition: all 0.18s ease;
        }

        .desktop-sidebar-toggle:hover {
            transform: scale(1.06);
            background: var(--primary-dark);
        }

        @media (min-width: 1024px) {
            .desktop-sidebar-toggle {
                display: flex;
            }

            .sidebar:not(.collapsed)~.main-content+.desktop-sidebar-toggle {
                left: calc(var(--sidebar-width) + 20px);
            }
        }

        /* ====== Responsive ====== */
        @media (max-width: 768px) {
            .metric-grid {
                grid-template-columns: 1fr;
            }

            .table-row {
                flex-wrap: wrap;
                padding: 12px;
            }

            .table-cell {
                flex: 0 0 50%;
                margin-bottom: 8px;
            }

            .hide-mobile {
                display: none;
            }

            .header .text-truncate {
                max-width: 55vw;
            }
        }

        /* ====== Accessibility ====== */
        .touch-target {
            min-height: 48px;
            min-width: 48px;
        }

        button:focus,
        a:focus,
        input:focus,
        select:focus {
            outline: 3px solid rgba(14, 165, 233, 0.2);
            outline-offset: 2px;
        }

        /* ====== Print Styles ====== */
        @media print {

            .header,
            .sidebar,
            .btn,
            .no-print,
            .desktop-sidebar-toggle,
            .sidebar-overlay {
                display: none !important;
            }

            body {
                background: white !important;
                color: black !important;
            }

            .main-content {
                margin-left: 0 !important;
            }
        }

        /* ====== Reduced Motion ====== */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* ====== Cyber Button Styles ====== */
        .cyber-button {
            padding: 10px 18px;
            border-radius: 12px;
            font-weight: 800;
            color: white;
            transition: all 0.25s ease;
            position: relative;
            overflow: hidden;
            background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%);
            box-shadow: 0 10px 30px rgba(14, 165, 233, 0.12);
        }

        .cyber-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 18px 50px rgba(14, 165, 233, 0.16);
        }

        .cyber-button-secondary {
            padding: 10px 18px;
            border-radius: 12px;
            font-weight: 700;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border: 1px solid #cbd5e1;
            color: #1e293b;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.04);
        }

        /* Floating bottom nav safe area padding for iOS */
        .mobile-bottom-nav {
            padding-bottom: calc(12px + env(safe-area-inset-bottom));
        }

        /* small helper to truncate text nicely */
        .text-truncate {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        /* ====== Update Progress Indicator ====== */
        .update-progress {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: rgba(14, 165, 233, 0.1);
            z-index: 9999;
        }

        .update-progress-bar {
            height: 100%;
            background: var(--primary);
            width: 0;
            transition: width 0.3s ease;
        }

        main,
        .main-content,
        .page-container {
            padding-bottom: calc(80px + env(safe-area-inset-bottom)) !important;
        }
    </style>
</head>

<body>
    <!-- PWA Loading Screen -->
    <div class="pwa-loading" id="pwaLoading">
        <div class="pwa-logo">
            <i class="fas fa-industry text-white text-3xl"></i>
        </div>
        <div class="text-xl font-bold text-gray-800">Transs Flow</div>
        <div class="text-sm text-gray-600 mt-2">Loading...</div>
    </div>

    <!-- Header -->
    <header class="header bg-white shadow no-print">
        <div class="px-4 py-2 flex items-center justify-between relative max-w-[1300px] mx-auto">
            <!-- Left: Menu + Logo -->
            <div class="flex items-center gap-4 flex-shrink-0">
                <!-- Mobile menu toggle -->
                <button onclick="toggleSidebar()" aria-label="Open menu"
                    class="mobile-sidebar-toggle touch-target md:hidden" title="Open menu">
                    <i class="fas fa-bars text-gray-700 text-lg"></i>
                </button>

                <!-- Logo -->
                <div class="flex items-center gap-2">
                    {% if request.user.is_superuser or request.user.role == "admin" %}
                    <a href="{% url 'dashboard' %}" class="hidden sm:block">
                        <img src="{% static 'screenshots/logo.png' %}" 
                            alt="TF Logo" 
                            class="w-48 h-16 rounded-lg">
                    </a>
                                        {% else %}
                    <a href="{% url 'ipqc_home' %}" class="hidden sm:block">
                        <div>
                             <img src="{% static 'screenshots/logo.png' %}" 
                            alt="TF Logo" 
                            class="w-48 h-16 rounded-lg">
                        </div>
                    </a>
                    {% endif %}
                </div>
            </div>

            <!-- Center: Page Title -->
            <div class="absolute left-1/2 transform -translate-x-1/2 text-center px-2">
                <div
                    class="text-gray-900 font-semibold text-base sm:text-lg md:text-xl truncate max-w-[70vw] sm:max-w-[50vw] text-truncate">
                    {% block title %}{% endblock %}
                </div>
            </div>

            <!-- Right: User Dropdown -->
            <div class="flex items-center gap-3 flex-shrink-0">
                <div class="user-dropdown relative" id="userDropdown">
                    <div class="user-dropdown-toggle" onclick="toggleUserDropdown()" role="button" aria-haspopup="true"
                        aria-expanded="false" title="User menu">
                        <img src="https://picsum.photos/seed/user/32/32" alt="User"
                            class="w-8 h-8 rounded-full border-2 border-gray-200 object-cover">
                        <div class="hidden md:block">
                            <div class="text-sm font-bold text-gray-900 truncate max-w-[120px]">{{ user.full_name|default:'' }}</div>
                            <div class="text-xs text-gray-600 font-medium truncate max-w-[120px]">
                                {% if user.is_superuser %}
                                Superuser
                                {% elif user.is_staff %}
                                Admin
                                {% else %}
                                {{ user.role|default:'User' }}
                                {% endif %}
                            </div>
                        </div>
                        <i class="fas fa-chevron-down text-xs text-gray-500 transition-transform"
                            id="dropdownArrow"></i>
                    </div>

                    <div class="user-dropdown-menu" role="menu" aria-hidden="true">
                        <div class="user-dropdown-header">
                            <div class="flex items-center gap-3">
                                <img src="https://picsum.photos/seed/user/40/40" alt="User"
                                    class="w-10 h-10 rounded-full object-cover">
                                <div>
                                    <div class="font-semibold text-gray-900">{{ user.full_name|default:'' }}</div>
                                    <div class="text-xs text-gray-600">{{ user.employee_id|default:'' }}</div>
                                </div>
                            </div>
                        </div>

                        <a href="#" class="user-dropdown-item"><i class="fas fa-user"></i><span>My Profile</span></a>
                        <a href="#" class="user-dropdown-item"><i class="fas fa-cog"></i><span>Settings</span></a>
                        <a href="#" class="user-dropdown-item"><i class="fas fa-key"></i><span>Change
                                Password</span></a>
                        <a href="#" class="user-dropdown-item"><i class="fas fa-bell"></i><span>Notifications</span></a>

                        <div class="user-dropdown-divider"></div>

                        <a href="#" class="user-dropdown-item"><i class="fas fa-question-circle"></i><span>Help &
                                Support</span></a>
                        <a class="user-dropdown-item logout" href="{% url 'logout' %}"><i
                                class="fas fa-sign-out-alt"></i><span>Logout</span></a>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- App Shell -->
    <div class="app-shell">
        <!-- Main App Container -->
        <div class="app-container max-w-[1300px] mx-auto w-full">
            <!-- Sidebar -->
            <aside id="sidebar" class="sidebar no-print" aria-hidden="false">
                <div class="p-4">
                    <nav class="space-y-1" aria-label="Primary">
                        {% if request.user.is_superuser or request.user.role == "admin" %}
                        <a href="{% url 'dashboard' %}"
                            class="nav-item {% if request.resolver_match.url_name == 'dashboard' %}active{% endif %}">
                            <i class="fas fa-home"></i>
                            <span>Home</span>
                            {% if request.resolver_match.url_name == 'dashboard' %}
                            <span class="ml-auto bg-green-500 w-2 h-2 rounded-full"></span>
                            {% endif %}
                        </a>

                        <a href="{% url 'ipqc_home' %}"
                            class="nav-item {% if request.resolver_match.url_name == 'ipqc_home' %}active{% endif %}">
                            <i class="fas fa-chart-line"></i>
                            <span>IPQC Dashboard</span>
                            {% if request.resolver_match.url_name == 'ipqc_home' %}
                            <span class="ml-auto bg-green-500 w-2 h-2 rounded-full"></span>
                            {% endif %}
                        </a>
                        {% else %}
                        <a href="{% url 'ipqc_home' %}"
                            class="nav-item {% if request.resolver_match.url_name == 'ipqc_home' %}active{% endif %}">
                            <i class="fas fa-chart-line"></i>
                            <span>IPQC Dashboard</span>
                            {% if request.resolver_match.url_name == 'ipqc_home' %}
                            <span class="ml-auto bg-green-500 w-2 h-2 rounded-full"></span>
                            {% endif %}
                        </a>
                        {% endif %}

                        {% if request.user.is_superuser or request.user.role == "IPQC" %}
                        <a href="{% url 'ipqc_work_info' %}"
                            class="nav-item {% if request.resolver_match.url_name == 'ipqc_work_info' %}active{% endif %}">
                            <i class="fas fa-clipboard-list"></i>
                            <span>Work Info</span>
                            {% if request.resolver_match.url_name == 'ipqc_work_info' %}
                            <span class="ml-auto bg-green-500 w-2 h-2 rounded-full"></span>
                            {% endif %}
                        </a>

                        <div class="py-2">
                            <div class="px-4 py-2 text-xs font-bold text-gray-500 uppercase tracking-wider">Quality
                                Control
                            </div>
                        </div>

                        <a href="{% url 'operator_qualification_create' %}"
                            class="nav-item {% if request.resolver_match.url_name == 'operator_qualification_create' %}active{% endif %}">
                            <i class="fas fa-search"></i>
                            <span>MP Audit</span>
                            {% if request.resolver_match.url_name == 'operator_qualification_create' %}
                            <span class="ml-auto bg-green-500 w-2 h-2 rounded-full"></span>
                            {% endif %}
                        </a>

                        <a href="{% url 'ipqc_assembly_audit_create' %}"
                            class="nav-item {% if request.resolver_match.url_name == 'ipqc_assembly_audit_create' %}active{% endif %}">
                            <i class="fas fa-search"></i>
                            <span>Assembly Audit</span>
                            {% if request.resolver_match.url_name == 'ipqc_assembly_audit_create' %}
                            <span class="ml-auto bg-green-500 w-2 h-2 rounded-full"></span>
                            {% endif %}
                        </a>

                        <a href="{% url 'btb_checksheet_create' %}"
                            class="nav-item {% if request.resolver_match.url_name == 'btb_checksheet_create' %}active{% endif %}">
                            <i class="fas fa-clipboard-check"></i>
                            <span>BTB Checksheet</span>
                            {% if request.resolver_match.url_name == 'btb_checksheet_create' %}
                            <span class="ml-auto bg-green-500 w-2 h-2 rounded-full"></span>
                            {% endif %}
                        </a>

                        <a href="{% url 'ass_dummy_test_create' %}"
                            class="nav-item {% if request.resolver_match.url_name == 'ass_dummy_test_create' %}active{% endif %}">
                            <i class="fas fa-vial"></i>
                            <span>Dummy Test</span>
                            {% if request.resolver_match.url_name == 'ass_dummy_test_create' %}
                            <span class="ml-auto bg-green-500 w-2 h-2 rounded-full"></span>
                            {% endif %}
                        </a>

                        <a href="{% url 'esd_compliance_checklist_add' %}"
                            class="nav-item {% if request.resolver_match.url_name == 'esd_compliance_checklist_add' %}active{% endif %}">
                            <i class="fas fa-shield-alt"></i>
                            <span>ESD Compliance</span>
                            {% if request.resolver_match.url_name == 'esd_compliance_checklist_add' %}
                            <span class="ml-auto bg-green-500 w-2 h-2 rounded-full"></span>
                            {% endif %}
                        </a>

                        <div class="py-2">
                            <div class="px-4 py-2 text-xs font-bold text-gray-500 uppercase tracking-wider">Operations
                            </div>
                        </div>

                        <a href="{% url 'ipqc_disassemble_add' %}"
                            class="nav-item {% if request.resolver_match.url_name == 'ipqc_disassemble_add' %}active{% endif %}">
                            <i class="fas fa-tools"></i>
                            <span>Disassemble</span>
                            {% if request.resolver_match.url_name == 'ipqc_disassemble_add' %}
                            <span class="ml-auto bg-green-500 w-2 h-2 rounded-full"></span>
                            {% endif %}
                        </a>

                        <a href="{% url 'nc_issue_tracking_create' %}"
                            class="nav-item {% if request.resolver_match.url_name == 'nc_issue_tracking_create' %}active{% endif %}">
                            <i class="fas fa-exclamation-triangle text-red-500"></i>
                            <span>NC Issues</span>
                            {% if request.resolver_match.url_name == 'nc_issue_tracking_create' %}
                            <span class="ml-auto bg-green-500 w-2 h-2 rounded-full"></span>
                            {% endif %}
                            <span class="ml-2 bg-red-500 text-white text-xs px-2 py-1 rounded-full font-bold">2</span>
                        </a>

                        <a href="{% url 'dust_count_checklist_add' %}"
                            class="nav-item {% if request.resolver_match.url_name == 'dust_count_checklist_add' %}active{% endif %}">
                            <i class="fas fa-cloud"></i>
                            <span>Dust Count</span>
                            {% if request.resolver_match.url_name == 'dust_count_checklist_add' %}
                            <span class="ml-auto bg-green-500 w-2 h-2 rounded-full"></span>
                            {% endif %}
                        </a>
                        {% endif %}

                        <div class="py-2">
                            <div class="px-4 py-2 text-xs font-bold text-gray-500 uppercase tracking-wider">
                                Communication
                            </div>
                        </div>


                    </nav>

                    <!-- User section -->
                    <div class="mt-8 pt-4 border-t">
                        <div class="flex items-center gap-3 mb-4">
                            <img src="https://picsum.photos/seed/user/40/40" alt="User" class="w-10 h-10 rounded-full">
                            <div class="hidden md:block">
                                <div class="text-sm font-bold text-gray-900">{{ user.full_name|default:'' }}</div>
                                <div class="text-xs text-gray-600 font-medium">
                                    {% if user.is_superuser %}
                                    Superuser
                                    {% elif user.is_staff %}
                                    Admin
                                    {% else %}
                                    {{ user.role|default:'User' }}
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        <a href="{% url 'logout' %}" class="nav-item text-red-600">
                            <i class="fas fa-sign-out-alt"></i>
                            <span>Logout</span>
                        </a>
                    </div>
                </div>
            </aside>

            <!-- Main Content -->
            <main class="main-content" role="main" aria-live="polite">
                {% if messages %}
                <div class="mb-4 space-y-2">
                    {% for message in messages %}
                    <div
                        class="bg-blue-50 border border-blue-200 text-blue-800 px-4 py-3 rounded-lg flex items-center gap-2">
                        <i class="fas fa-info-circle"></i>
                        <span class="font-medium">{{ message }}</span>
                    </div>
                    {% endfor %}
                </div>
                {% endif %}

                {% block content %}
                <!-- Key Metrics -->
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6 metric-grid">
                    <div class="metric-card">
                        <div class="flex items-start justify-between">
                            <div>
                                <div class="metric-value">1,248</div>
                                <div class="metric-label">Units/Hour</div>
                                <div class="metric-change positive">
                                    <i class="fas fa-arrow-up mr-1"></i>12.5%
                                </div>
                            </div>
                            <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
                                <i class="fas fa-chart-line text-blue-600"></i>
                            </div>
                        </div>
                    </div>

                    <div class="metric-card">
                        <div class="flex items-start justify-between">
                            <div>
                                <div class="metric-value">96.8%</div>
                                <div class="metric-label">Efficiency</div>
                                <div class="metric-change positive">
                                    <i class="fas fa-arrow-up mr-1"></i>2.3%
                                </div>
                            </div>
                            <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center">
                                <i class="fas fa-tachometer-alt text-green-600"></i>
                            </div>
                        </div>
                    </div>

                    <div class="metric-card">
                        <div class="flex items-start justify-between">
                            <div>
                                <div class="metric-value">99.2%</div>
                                <div class="metric-label">Quality</div>
                                <div class="metric-change positive">
                                    <i class="fas fa-arrow-up mr-1"></i>0.5%
                                </div>
                            </div>
                            <div class="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center">
                                <i class="fas fa-award text-purple-600"></i>
                            </div>
                        </div>
                    </div>

                    <div class="metric-card">
                        <div class="flex items-start justify-between">
                            <div>
                                <div class="metric-value">24/28</div>
                                <div class="metric-label">Active Lines</div>
                                <div class="metric-change negative">
                                    <i class="fas fa-arrow-down mr-1"></i>4 idle
                                </div>
                            </div>
                            <div class="w-10 h-10 bg-yellow-100 rounded-lg flex items-center justify-center">
                                <i class="fas fa-industry text-yellow-600"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                    <a href="{% url 'ipqc_assembly_audit_create' %}" class="quick-action touch-target">
                        <i class="fas fa-plus-circle text-blue-500"></i>
                        <div class="label">New Audit</div>
                        <div class="desc">Start inspection</div>
                    </a>
                    <a href="{% url 'nc_issue_tracking_create' %}" class="quick-action touch-target">
                        <i class="fas fa-exclamation-triangle text-red-500"></i>
                        <div class="label">Report Issue</div>
                        <div class="desc">File NC report</div>
                    </a>
                    <a href="#" class="quick-action touch-target">
                        <i class="fas fa-download text-green-500"></i>
                        <div class="label">Export Data</div>
                        <div class="desc">Download reports</div>
                    </a>
                    <a href="#" class="quick-action touch-target">
                        <i class="fas fa-cog text-gray-500"></i>
                        <div class="label">Settings</div>
                        <div class="desc">System config</div>
                    </a>
                </div>

                <!-- Production Lines Status -->
                <div class="production-table">
                    <div class="table-row table-header">
                        <div class="table-cell w-20">Line ID</div>
                        <div class="table-cell">Product</div>
                        <div class="table-cell w-15">Status</div>
                        <div class="table-cell w-15 hide-mobile">Output</div>
                        <div class="table-cell w-15 hide-mobile">Quality</div>
                        <div class="table-cell w-15">Action</div>
                    </div>

                    <div class="table-row" role="row">
                        <div class="table-cell w-20">
                            <div class="font-mono font-bold text-gray-900">PL-001</div>
                        </div>
                        <div class="table-cell">
                            <div class="font-semibold text-gray-900">Component A</div>
                        </div>
                        <div class="table-cell w-15">
                            <span class="status-badge status-running">
                                <i class="fas fa-circle text-xs mr-1"></i>Running
                            </span>
                        </div>
                        <div class="table-cell w-15 hide-mobile">
                            <div class="font-bold text-gray-900">1,250/h</div>
                        </div>
                        <div class="table-cell w-15 hide-mobile">
                            <div class="text-green-700 font-bold">99.5%</div>
                        </div>
                        <div class="table-cell w-15">
                            <button class="btn btn-secondary text-sm touch-target" aria-label="View PL-001">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>

                    <div class="table-row" role="row">
                        <div class="table-cell w-20">
                            <div class="font-mono font-bold text-gray-900">PL-002</div>
                        </div>
                        <div class="table-cell">
                            <div class="font-semibold text-gray-900">Component B</div>
                        </div>
                        <div class="table-cell w-15">
                            <span class="status-badge status-running">
                                <i class="fas fa-circle text-xs mr-1"></i>Running
                            </span>
                        </div>
                        <div class="table-cell w-15 hide-mobile">
                            <div class="font-bold text-gray-900">980/h</div>
                        </div>
                        <div class="table-cell w-15 hide-mobile">
                            <div class="text-green-700 font-bold">98.7%</div>
                        </div>
                        <div class="table-cell w-15">
                            <button class="btn btn-secondary text-sm touch-target" aria-label="View PL-002">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>

                    <div class="table-row" role="row">
                        <div class="table-cell w-20">
                            <div class="font-mono font-bold text-gray-900">PL-003</div>
                        </div>
                        <div class="table-cell">
                            <div class="font-semibold text-gray-900">Component C</div>
                        </div>
                        <div class="table-cell w-15">
                            <span class="status-badge status-idle">
                                <i class="fas fa-pause text-xs mr-1"></i>Maintenance
                            </span>
                        </div>
                        <div class="table-cell w-15 hide-mobile">
                            <div class="text-gray-500 font-semibold">-</div>
                        </div>
                        <div class="table-cell w-15 hide-mobile">
                            <div class="text-gray-500 font-semibold">-</div>
                        </div>
                        <div class="table-cell w-15">
                            <button class="btn btn-secondary text-sm touch-target" aria-label="PL-003 actions">
                                <i class="fas fa-tools"></i>
                            </button>
                        </div>
                    </div>

                    <div class="table-row" role="row">
                        <div class="table-cell w-20">
                            <div class="font-mono font-bold text-gray-900">PL-004</div>
                        </div>
                        <div class="table-cell">
                            <div class="font-semibold text-gray-900">Component D</div>
                        </div>
                        <div class="table-cell w-15">
                            <span class="status-badge status-stop">
                                <i class="fas fa-stop text-xs mr-1"></i>Stopped
                            </span>
                        </div>
                        <div class="table-cell w-15 hide-mobile">
                            <div class="text-gray-500 font-semibold">-</div>
                        </div>
                        <div class="table-cell w-15 hide-mobile">
                            <div class="text-gray-500 font-semibold">-</div>
                        </div>
                        <div class="table-cell w-15">
                            <button class="btn btn-primary text-sm touch-target" aria-label="Start PL-004">
                                <i class="fas fa-play"></i>
                            </button>
                        </div>
                    </div>
                </div>
                {% endblock %}
            </main>
        </div>

        <!-- Desktop sidebar toggle button -->
        <button id="desktopToggle" class="desktop-sidebar-toggle no-print" onclick="toggleDesktopSidebar()"
            aria-label="Toggle sidebar">
            <i class="fas fa-bars"></i>
        </button>

        <!-- Sidebar overlay for mobile -->
        <div class="sidebar-overlay" onclick="closeSidebar()"></div>

        <!-- Floating bottom nav (mobile only) -->
        <nav class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 flex justify-around py-2 z-50 md:hidden mobile-bottom-nav no-print"
            role="navigation" aria-label="Mobile navigation">
            <a href="{% url 'dashboard' %}"
                class="flex flex-col items-center text-gray-600 hover:text-sky-600 touch-target" aria-label="Home">
                <i class="fas fa-home text-lg"></i>
                <span class="text-xs mt-1">Home</span>
            </a>
            <a href="{% url 'work_info_list' %}"
                class="flex flex-col items-center text-gray-600 hover:text-sky-600 touch-target" aria-label="IPQC">
                <i class="fas fa-chart-line text-lg"></i>
                <span class="text-xs mt-1">Work Line</span>
            </a>
            <a href="{% url 'create_issue' %}"
                class="flex flex-col items-center text-gray-600 hover:text-sky-600 touch-target" aria-label="Issues">
                <i class="fas fa-exclamation-triangle text-lg"></i>
                <span class="text-xs mt-1">Issues</span>
            </a>

            <a href="{% url 'logout' %}"
                class="flex flex-col items-center text-gray-600 hover:text-sky-600 touch-target" aria-label="Profile">
                <i class="fas fa-user text-lg"></i>
                <span class="text-xs mt-1">Profile</span>
            </a>
        </nav>
    </div>

    <!-- Update Progress Indicator -->
    <div class="update-progress" id="updateProgress" style="display: none;">
        <div class="update-progress-bar" id="updateProgressBar"></div>
    </div>

    <!-- Service worker registration -->
    <script>
        // ====== State Management ======
        const appState = {
            sidebarCollapsed: localStorage.getItem('sidebar-collapsed') === 'true',
            isMobile: window.innerWidth < 1024,
            userDropdownOpen: false,
            isOnline: navigator.onLine,
            deferredPrompt: null,
            updateAvailable: false,
            registration: null,
            installPromptShown: localStorage.getItem('install-prompt-shown') === 'true',
            isFirstVisit: !localStorage.getItem('hasVisited')
        };

        // ====== DOM Elements ======
        const elements = {
            sidebar: document.getElementById('sidebar'),
            overlay: document.querySelector('.sidebar-overlay'),
            toggleBtn: document.getElementById('desktopToggle'),
            mainContent: document.querySelector('.main-content'),
            body: document.body,
            userDropdown: document.getElementById('userDropdown'),
            dropdownArrow: document.getElementById('dropdownArrow'),
            pwaLoading: document.getElementById('pwaLoading'),
            updateProgress: document.getElementById('updateProgress'),
            updateProgressBar: document.getElementById('updateProgressBar')
        };

        // ====== PWA Service Worker Management ======
        function registerServiceWorker() {
            // Always mark as visited and hide loading screen after a reasonable time
            localStorage.setItem('hasVisited', 'true');
            
            // Set a timeout to hide loading screen regardless of service worker status
            const loadingTimeout = setTimeout(() => {
                elements.pwaLoading.classList.add('hidden');
                console.log('Loading screen hidden due to timeout');
            }, 3000); // 3 second maximum
            
            if ('serviceWorker' in navigator) {
                window.addEventListener('load', () => {
                    navigator.serviceWorker.register("{% url 'service_worker' %}")
                        .then(registration => {
                            console.log('ServiceWorker registered: ', registration.scope);
                            appState.registration = registration;

                            // Check for updates
                            registration.addEventListener('updatefound', () => {
                                const newWorker = registration.installing;
                                newWorker.addEventListener('statechange', () => {
                                    if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                        console.log('New version available');
                                        showUpdateNotification();
                                    }
                                });
                            });

                            // Hide loading screen when service worker is ready
                            clearTimeout(loadingTimeout);
                            elements.pwaLoading.classList.add('hidden');
                            console.log('Loading screen hidden after service worker registration');
                        })
                        .catch(err => {
                            console.log('ServiceWorker registration failed: ', err);
                            // Still hide loading screen even if registration fails
                            clearTimeout(loadingTimeout);
                            elements.pwaLoading.classList.add('hidden');
                            console.log('Loading screen hidden despite service worker error');
                        });
                });
            } else {
                // No service worker support, hide loading screen anyway
                clearTimeout(loadingTimeout);
                elements.pwaLoading.classList.add('hidden');
                console.log('Loading screen hidden - no service worker support');
            }
        }

        // ====== Install Prompt Management ======
        function setupInstallPrompt() {
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                appState.deferredPrompt = e;
                
                // Only show install notification if not already shown
                if (!appState.installPromptShown && appState.isFirstVisit) {
                    showInstallNotification();
                    localStorage.setItem('install-prompt-shown', 'true');
                    appState.installPromptShown = true;
                }
            });
            
            window.addEventListener('appinstalled', () => {
                console.log('PWA was installed');
                localStorage.setItem('install-prompt-shown', 'true');
                appState.installPromptShown = true;
            });
        }

        function showInstallNotification() {
            if (appState.deferredPrompt && !appState.installPromptShown && appState.isFirstVisit) {
                // Create a temporary notification element
                const notification = document.createElement('div');
                notification.className = 'fixed top-4 right-4 bg-blue-500 text-white p-4 rounded-lg shadow-lg z-50 max-w-md';
                notification.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div>
                            <h3 class="font-bold text-lg">Install TranssFlow</h3>
                            <p class="mt-1">Install the app for the best experience!</p>
                        </div>
                        <button class="ml-4 text-white hover:text-gray-200" onclick="this.parentElement.parentElement.remove()">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="mt-3 flex justify-end space-x-2">
                        <button class="px-3 py-1 bg-white text-blue-500 rounded hover:bg-gray-100" onclick="this.closest('.fixed').remove()">
                            Not Now
                        </button>
                        <button class="px-3 py-1 bg-blue-700 text-white rounded hover:bg-blue-800" onclick="installApp(); this.closest('.fixed').remove();">
                            Install
                        </button>
                    </div>
                `;
                document.body.appendChild(notification);
                
                // Auto-hide after 10 seconds
                setTimeout(() => {
                    if (notification.parentElement) {
                        notification.remove();
                    }
                }, 10000);
            }
        }

        function installApp() {
            if (appState.deferredPrompt) {
                appState.deferredPrompt.prompt();
                appState.deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('User accepted the install prompt');
                    }
                    appState.deferredPrompt = null;
                });
            }
        }

        // ====== Update Management ======
        function showUpdateNotification() {
            // Create a temporary notification element
            const notification = document.createElement('div');
            notification.className = 'fixed top-4 right-4 bg-blue-500 text-white p-4 rounded-lg shadow-lg z-50 max-w-md';
            notification.innerHTML = `
                <div class="flex justify-between items-start">
                    <div>
                        <h3 class="font-bold text-lg">Update Available</h3>
                        <p class="mt-1">A new version of TranssFlow is available. Refresh to update.</p>
                    </div>
                    <button class="ml-4 text-white hover:text-gray-200" onclick="this.parentElement.parentElement.remove()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="mt-3 flex justify-end space-x-2">
                    <button class="px-3 py-1 bg-white text-blue-500 rounded hover:bg-gray-100" onclick="this.closest('.fixed').remove()">
                        Later
                    </button>
                    <button class="px-3 py-1 bg-blue-700 text-white rounded hover:bg-blue-800" onclick="window.location.reload();">
                        Update Now
                    </button>
                </div>
            `;
            document.body.appendChild(notification);
            
            // Auto-hide after 10 seconds
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.remove();
                }
            }, 10000);
        }

        // ====== Sidebar Functions ======
        function toggleSidebar() {
            if (appState.isMobile) {
                elements.sidebar.classList.toggle('active');
                elements.overlay.classList.toggle('active');
                // lock scroll behind overlay to mimic app modal
                elements.body.style.overflow = elements.sidebar.classList.contains('active') ? 'hidden' : '';
                // set aria states
                elements.sidebar.setAttribute('aria-hidden', elements.sidebar.classList.contains('active') ? 'false' : 'true');
            }
        }

        function closeSidebar() {
            if (appState.isMobile) {
                elements.sidebar.classList.remove('active');
                elements.overlay.classList.remove('active');
                elements.body.style.overflow = '';
                elements.sidebar.setAttribute('aria-hidden', 'true');
            }
        }

        function toggleDesktopSidebar() {
            elements.sidebar.classList.toggle('collapsed');
            updateToggleButton();
            saveSidebarState();
        }

        function updateToggleButton() {
            const icon = elements.toggleBtn.querySelector('i');
            if (elements.sidebar.classList.contains('collapsed')) {
                icon.className = 'fas fa-bars';
            } else {
                icon.className = 'fas fa-times';
            }
        }

        function saveSidebarState() {
            appState.sidebarCollapsed = elements.sidebar.classList.contains('collapsed');
            localStorage.setItem('sidebar-collapsed', appState.sidebarCollapsed);
        }

        function initializeSidebar() {
            if (!appState.isMobile && appState.sidebarCollapsed) {
                elements.sidebar.classList.add('collapsed');
            }
            updateToggleButton();
        }

        // ====== User Dropdown Functions ======
        function toggleUserDropdown() {
            appState.userDropdownOpen = !appState.userDropdownOpen;

            if (appState.userDropdownOpen) {
                elements.userDropdown.classList.add('active');
                elements.dropdownArrow.style.transform = 'rotate(180deg)';
                elements.userDropdown.setAttribute('aria-expanded', 'true');
                // Close dropdown when clicking outside
                setTimeout(() => {
                    document.addEventListener('click', closeUserDropdownOutside);
                }, 100);
            } else {
                elements.userDropdown.classList.remove('active');
                elements.dropdownArrow.style.transform = 'rotate(0deg)';
                elements.userDropdown.setAttribute('aria-expanded', 'false');
                document.removeEventListener('click', closeUserDropdownOutside);
            }
        }

        function closeUserDropdown() {
            appState.userDropdownOpen = false;
            elements.userDropdown.classList.remove('active');
            elements.dropdownArrow.style.transform = 'rotate(0deg)';
            elements.userDropdown.setAttribute('aria-expanded', 'false');
            document.removeEventListener('click', closeUserDropdownOutside);
        }

        function closeUserDropdownOutside(event) {
            if (!elements.userDropdown.contains(event.target)) {
                closeUserDropdown();
            }
        }

        // ====== Utility Functions ======
        function updateMetrics() {
            const metricElements = document.querySelectorAll('.metric-value');
            metricElements.forEach(el => {
                // read value but preserve suffix like %
                const text = el.textContent.trim();
                const isPercent = text.includes('%');
                const numeric = parseFloat(text.replace(/[^0-9.]/g, ''));
                if (!isNaN(numeric)) {
                    const change = (Math.random() - 0.5) * numeric * 0.05;
                    let newValue = numeric + change;
                    if (isPercent) {
                        newValue = Math.max(0, Math.min(100, newValue));
                        el.textContent = newValue.toFixed(1) + '%';
                    } else {
                        newValue = Math.max(0, newValue);
                        el.textContent = Math.round(newValue).toLocaleString();
                    }
                }
            });
        }

        function handleResize() {
            const wasMobile = appState.isMobile;
            appState.isMobile = window.innerWidth < 1024;

            // Reset states when crossing breakpoint
            if (wasMobile !== appState.isMobile) {
                closeSidebar();
                closeUserDropdown();

                if (!appState.isMobile) {
                    elements.sidebar.classList.remove('active');
                    initializeSidebar();
                } else {
                    elements.sidebar.classList.remove('collapsed');
                }
            }
        }

        // ====== Event Listeners ======
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                if (appState.userDropdownOpen) {
                    closeUserDropdown();
                } else if (appState.isMobile && elements.sidebar.classList.contains('active')) {
                    closeSidebar();
                }
            }
        });

        // Prevent dropdown from closing when clicking inside it
        if (elements.userDropdown) {
            elements.userDropdown.addEventListener('click', (e) => {
                e.stopPropagation();
            });
        }

        let resizeTimer;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimer);
            resizeTimer = setTimeout(handleResize, 200);
        });

        // Close all submenus when clicking outside
        document.addEventListener('click', function (event) {
            if (!event.target.closest('.sidebar-item')) {
                document.querySelectorAll('[id$="-submenu"]').forEach(submenu => {
                    submenu.classList.add('hidden');
                });
                document.querySelectorAll('[id$="-chevron"]').forEach(chevron => {
                    chevron.style.transform = 'rotate(0deg)';
                });
            }
        });

        // ====== Initialize ======
        document.addEventListener('DOMContentLoaded', () => {
            // Only show loading screen if it's the first visit
            if (appState.isFirstVisit) {
                // Hide loading screen after a short delay in case service worker registration takes time
                setTimeout(() => {
                    if (!elements.pwaLoading.classList.contains('hidden')) {
                        elements.pwaLoading.classList.add('hidden');
                    }
                }, 2000);
            }
            
            initializeSidebar();
            registerServiceWorker();
            setupInstallPrompt();
            setInterval(updateMetrics, 30000);
        });

        // ====== Expose functions globally ======
        window.toggleSidebar = toggleSidebar;
        window.closeSidebar = closeSidebar;
        window.toggleDesktopSidebar = toggleDesktopSidebar;
        window.toggleUserDropdown = toggleUserDropdown;
        window.closeUserDropdown = closeUserDropdown;
        window.installApp = installApp;

        // ====== Handle service worker messages ======
        navigator.serviceWorker.addEventListener('message', event => {
            console.log('Received message from service worker:', event.data);
            
            if (event.data && event.data.type === 'SKIP_WAITING') {
                self.skipWaiting();
            }
        });

        // ====== Handle app updates ======
        // Check if there's a pending update reminder
        const updateReminder = localStorage.getItem('update-reminder');
        if (updateReminder) {
            const reminderTime = parseInt(updateReminder);
            const hoursSinceReminder = (Date.now() - reminderTime) / (1000 * 60 * 60);
            
            // If more than 24 hours have passed, show the update notification again
            if (hoursSinceReminder > 24) {
                localStorage.removeItem('update-reminder');
                showUpdateNotification();
            }
        }
    </script>

    {% block extra_js %}{% endblock %}
</body>

</html>


transs_flow/settings.py:



"""
Django settings for transs_flow project.

Generated by 'django-admin startproject' using Django 5.2.7.

For more information on this file, see
https://docs.djangoproject.com/en/5.2/topics/settings/

For the full list of settings and their values, see
https://docs.djangoproject.com/en/5.2/ref/settings/
"""

from pathlib import Path
import os
# Build paths inside the project like this: BASE_DIR / 'subdir'.
BASE_DIR = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))


# Quick-start development settings - unsuitable for production
# See https://docs.djangoproject.com/en/5.2/howto/deployment/checklist/

# SECURITY WARNING: keep the secret key used in production secret!
SECRET_KEY = 'django-insecure-*dl&t7!4eu%antq@qp!*t$#h4&8#rinibme#@29budotu5zfgu'

# SECURITY WARNING: don't run with debug turned on in production!
DEBUG = True

ALLOWED_HOSTS = ['127.0.0.1', 'localhost', '10.66.123.155', 'https://mrsingh29.pythonanywhere.com']


# Application definition

INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    'accounts',
    'core',
    'factories.assembly.departments.qa.ipqc',
    'factories.assembly.departments.qa',
    'factories.assembly.departments',
    'factories.assembly',
    'factories',
    
    'widget_tweaks',
    
    'rest_framework',
    'rest_framework.authtoken',
    'corsheaders',
    
]

MIDDLEWARE = [
    'django.middleware.security.SecurityMiddleware',
    'django.contrib.sessions.middleware.SessionMiddleware',
    'django.middleware.common.CommonMiddleware',
    'django.middleware.csrf.CsrfViewMiddleware',
    'django.contrib.auth.middleware.AuthenticationMiddleware',
    'django.contrib.messages.middleware.MessageMiddleware',
    'django.middleware.clickjacking.XFrameOptionsMiddleware',
    'corsheaders.middleware.CorsMiddleware',
]

ROOT_URLCONF = 'transs_flow.urls'

TEMPLATES = [
    {
        "BACKEND": "django.template.backends.django.DjangoTemplates",
        "DIRS": [os.path.join(BASE_DIR, "templates")],  # Add your templates folder here
        "APP_DIRS": True,  # This still keeps app templates discoverable
        "OPTIONS": {
            "context_processors": [
                "django.template.context_processors.debug",
                "django.template.context_processors.request",
                "django.contrib.auth.context_processors.auth",
                "django.contrib.messages.context_processors.messages",
                
            ],
        },
    },
]

WSGI_APPLICATION = 'transs_flow.wsgi.application'


# Database
# https://docs.djangoproject.com/en/5.2/ref/settings/#databases

# ---------------------- MYSQL (Aiven) ----------------------
MYSQL_HOST = "mysql-rty-rty.d.aivencloud.com"
MYSQL_PORT = 16775
MYSQL_USER = "avnadmin"
MYSQL_PASSWORD = "AVNS_COcv7nfPnntH_BeZ84u"
MYSQL_DB = "transs_flow_final"
MYSQL_ACCOUNT_DB = "transs_account"
MYSQL_DB_MODEL = "defaultdb"
MYSQL_DB_CHAT = "chatdb"
MYSQL_CA = os.path.join(BASE_DIR, "certs", "aiven-ca.pem")

DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.mysql',
        'NAME': MYSQL_DB,
        'USER': MYSQL_USER,
        'PASSWORD': MYSQL_PASSWORD,
        'HOST': MYSQL_HOST,
        'PORT': MYSQL_PORT,
        'OPTIONS': {
            'ssl': {
                'ca': MYSQL_CA,
            },
        },
    },
    
    'defaultdb': {
        'ENGINE': 'django.db.backends.mysql',
        'NAME': MYSQL_DB_MODEL,
        'USER': MYSQL_USER,
        'PASSWORD': MYSQL_PASSWORD,
        'HOST': MYSQL_HOST,
        'PORT': MYSQL_PORT,
        'OPTIONS': {
            'ssl': {
                'ca': MYSQL_CA,
            },
        },
    },
    'chatdb': {
        'ENGINE': 'django.db.backends.mysql',
        'NAME': MYSQL_DB_CHAT,
        'USER': MYSQL_USER,
        'PASSWORD': MYSQL_PASSWORD,
        'HOST': MYSQL_HOST,
        'PORT': MYSQL_PORT,
        'OPTIONS': {
            'ssl': {
                'ca': MYSQL_CA,
            },
        },
    },
}


# Password validation
# https://docs.djangoproject.com/en/5.2/ref/settings/#auth-password-validators

AUTH_PASSWORD_VALIDATORS = [
    {
        'NAME': 'django.contrib.auth.password_validation.UserAttributeSimilarityValidator',
    },
    {
        'NAME': 'django.contrib.auth.password_validation.MinimumLengthValidator',
    },
    {
        'NAME': 'django.contrib.auth.password_validation.CommonPasswordValidator',
    },
    {
        'NAME': 'django.contrib.auth.password_validation.NumericPasswordValidator',
    },
]


# Internationalization
# https://docs.djangoproject.com/en/5.2/topics/i18n/

LANGUAGE_CODE = 'en-us'

TIME_ZONE = 'Asia/Kolkata'

USE_I18N = True

USE_TZ = True


# Static files (CSS, JavaScript, Images)
# https://docs.djangoproject.com/en/5.2/howto/static-files/

STATIC_URL = 'static/'

# Default primary key field type
# https://docs.djangoproject.com/en/5.2/ref/settings/#default-auto-field

DEFAULT_AUTO_FIELD = 'django.db.models.BigAutoField'


LOGIN_URL = '/login/'

# Lark Open Platform credentials
LARK_APP_ID = "cli_a802ed86e438d028"          # Your Lark App ID
LARK_APP_SECRET = "mfbtudMamxM9nKq5tUoh43AJNJT7iJWu"  # Your Lark App Secret

# Bitable App token
LARK_BITABLE_APP_TOKEN_QA = "UbZRbYrtqaDGwMsY9WmlqhAmgGf"  # Your Bitable App Token

# Feishu App ID for IPQC Department
FEISHU_APP_ID = "cli_a83144a175fad00c"
FEISHU_APP_SECRET = "btMHmH3lAqIPQrX5RdIPRcAqn066kCmj"
FEISHU_TABLE_ID  = "tblMZ9PkpgS4cmrq"

# Table IDs for different types of records
LARK_TABLE_IPQC_WORK_INFO = "tblVIUGu6K3bLdJa"                 # For normal work info
LARK_TABLE_BTB_FITMENT_CHECKSHEET = "tbl2t96Qr6eA0jiA"
LARK_TABLE_BUMMY_CHECKSHEET = "tblVei5hahB9MWrV"
LARK_TABLE_DESSEMBLE_CHECKLIST = "tbloHbXh3fhRCskF"
LARK_TABLE_ASSEMBLY_AUDIT = "tbl4ZmtcKC8F6zre"
LARK_TABLE_NC_ISSUE_TRACKING = "tblhQaAEQfwuzWpu"
LARK_TABLE_ESD_COMPLIANCE = "tblZbqVZw4X3HCzA"
LARK_TABLE_DUST_MEASUREMENT = "tblq4hfUqiEnnAYn"
LARK_TABLE_TESTING_FAI = "tblckPOHzkHQGbFN"


AUTH_USER_MODEL = 'accounts.Employee'


DATABASE_ROUTERS = ["chat.db_router.ChatRouter"]

# Channels setup
INSTALLED_APPS += ["channels", "chat"]

ASGI_APPLICATION = "transs_flow.asgi.application"

CHANNEL_LAYERS = {
    "default": {
        "BACKEND": "channels_redis.core.RedisChannelLayer",
        "CONFIG": {"hosts": [("127.0.0.1", 6379)]},
    },
}

MEDIA_URL = '/media/'
MEDIA_ROOT = os.path.join(BASE_DIR, 'media')



REST_FRAMEWORK = {
    'DEFAULT_AUTHENTICATION_CLASSES': [
        'rest_framework.authentication.TokenAuthentication',
    ],
    'DEFAULT_PERMISSION_CLASSES': [
        'rest_framework.permissions.IsAuthenticated',
    ],
    'DEFAULT_PAGINATION_CLASS': 'rest_framework.pagination.PageNumberPagination',
    'PAGE_SIZE': 20
}

CORS_ALLOW_ALL_ORIGINS = True  # Only for development
CORS_ALLOW_CREDENTIALS = True




STATICFILES_DIRS = [
    os.path.join(BASE_DIR, 'static'),
]
 
# Ensure static files are collected
if not DEBUG:
    STATIC_ROOT = os.path.join(BASE_DIR, 'staticfiles')
else:
    STATIC_ROOT = os.path.join(BASE_DIR, 'staticfiles')
 
# Add PWA headers
SECURE_CONTENT_TYPE_NOSNIFF = True
SECURE_BROWSER_XSS_FILTER = True
X_CONTENT_TYPE_OPTIONS = 'nosniff'


FEISHU_APP_ID_1 = "cli_a99693af7ff85ed4"
FEISHU_APP_SECRET_1 = "9oqJA4pda5klg3D1vGDsxfJmUCnWZUCO"
FEISHU_REDIRECT_URI_1 = "https://mrsingh29.pythonanywhere.com/feishu/callback/"